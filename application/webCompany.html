<!DOCTYPE html>
<!-- saved from url=(0566)https://www10c1.53kf.com/webCompany.php?kf_sign=jc0MzMTYyNMzMDEwODEyNjEzNzk3MDAwNzA3NTEyNjk=&arg=9007605&style=1&kflist=off&kf=anna%40ecfocus.com%2C13590308967%40qq.com&zdkf_type=1&lnk_overflow=0&language=zh-cn&charset=gbk&username=&userinfo=&introurl=&lyurl=&lytype=0&copartner=&referer=http%3A%2F%2Fwww.ecfocus.com%2Fwebsite.html&keyword=http%3A%2F%2Fwww.ecfocus.com%2Fcases-c1.html&brief=&logo=&question=&uid=042173d2acb9c1eff038ce8557d29d92&guest_id=10091778952020&tfrom=2&tpl=minichat2&timeStamp=1626743340582&interface_color=1&interface_theme=1&minchat_style=1 -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <!-- <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> -->
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <!--引入头部文件-->
    <script>
var company_id = "70751269";//公司id
var obj_id = 0; // 客服ID
var myid = "-1"; // 访客id
var style = "1";
var style_id = "103697707";
var guest_id = "175421564410";//备用访客编号
var http_pro = (document.location.protocol == 'https:')?'https://':'http://';//区分HTTP和HTTPS
var host = "www10c1.53kf.com";
var language = "cn";
</script>
<link rel="stylesheet" type="text/css" href="./code.css"><link href="./default.css" rel="stylesheet"></head><body><span id="plugin_snapshot" style="display: none;"></span>    <!--引入CSS-->
    <link rel="stylesheet" type="text/css" href="./swiper.min.css">
    <link rel="stylesheet" href="./minichat.css">

    <!-- 别删这段注释=====================start===================== -->

    <!--ie8下给他边框-->
    <!--[if IE 8]>
    <style>
        .newWindow {
            border:1px solid #ccc;
            width:358px;
            height:422px;
        }
        .newWindow.window_size400 {
            height:362px;
        }
    </style>
    <![endif]-->

    <!-- 别删这段注释=====================end===================== -->
    <style>
        /*
        消息展示区域高度判断 19.2.4 
        */

       /* 存在底部外链  */
       
        .talk .pc-visitor-main {padding-bottom: 109px;}
        .talk.hasCallBack .pc-visitor-main {padding-bottom: 139px;}
        .talk.hasScene .pc-visitor-main {padding-bottom: 18px;}


        #pcWrap .pc-visitor-footer {bottom: 15px;}
        #float_to53{z-index: 210;position: absolute; bottom: 0; width: 100%; height: 18px; background: #f8f7f7;  font-size: 12px; text-align: center; line-height: 18px;}
        #float_to53 a{text-decoration: none;color: #8DA2B5;}
        #float_to53 a:hover{color: #218BFC; text-decoration: underline; }
        .sm_triangle{display: none !important; }
       


       /* 不存在底部外链  */
       
        .loading_box{
            width: 50px;
            height: 47px;
            position: relative;
        }
        .message_loading {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            position: absolute;
            animation: loader 0.5s linear alternate infinite;
            top: -25px;
            left: 15px;
        }

        @keyframes loader {
            0% {
                box-shadow: -14px 40px 0 2px #8DA2B5,  0 40px 0 0 #8DA2B5,  14px 40px 0 0 #8DA2B5; }
            50% {
                box-shadow: -14px 40px 0 0 #8DA2B5, 0 40px 0 2px #8DA2B5, 14px 40px 0 0 #8DA2B5; }
            100% {
                box-shadow: -14px 40px 0 0 #8DA2B5, 0 40px 0 0 #8DA2B5, 14px 40px 0 2px #8DA2B5; }
        }

       /* ------------------------*/

        
       /* 互动菜单预览 */
       #scroll_menu_box_by53kf{width:100%; height:30px;position: absolute; top: -33px; z-index: 0;display: none; }
       .menu_open{position: absolute; top: 0;background: #FFF; left: 0; height: 32px; width: 24px; z-index: 99; display: none; font-size: 18px;line-height: 38px;border-radius:0 4px 4px 0; border:1px solid #D8DFEA; cursor: pointer;color:#62778C; }
       .menu_open .open_btn_line{float: left; width: 2px; height: 24px; background: #CED5E0; margin-right: 4px; }
       .scroll_body{width:100%; height:30px;padding-right: 16px; }
       #scroll_menu{width: 100%; height: 32px;padding: 4px 10px 0 6px;  overflow: hidden; background:#FAF9F8; position: relative; margin: 0 !important; cursor: move;  position: relative; }
       #scroll_menu.btn_left{padding: 3px 6px 0 44px; }
       #scroll_menu_box_by53kf .menu_btn{cursor: pointer;font-size: 12px; color: #62778C; padding: 0 8px; line-height: 22px;height: 24px; border-radius:15px; border:1px solid #CED5E0; text-align: center; display: inline-block; width: auto;margin: 0 4px; background: #FFF; }
       #scroll_menu_box_by53kf .menu_btn:hover {background: #3B99FC; border-color: #3B99FC; color: #fff;}
       #scroll_menu_box_by53kf .menu_btn:active{background: #3489E2; border-color:#3B99FC; color: #fff; }
       #scroll_menu_box_by53kf .menu_close{display: none !important; height: 100%; width: 48px; background: #FFF; position: absolute; top: 0; right: 0; padding-top: 4px; z-index: 100; text-align: center; cursor: pointer;}
       #scroll_menu_box_by53kf .menu_up{height: 100%; width: 48px; background: #FAF9F8; position: absolute; top: 0; left: 0; padding-top: 3px; z-index: 100; text-align: center; cursor: pointer; display: none;}
       #scroll_menu_box_by53kf .menu_close .menu_btn{width: 32px; }
       #scroll_menu_box_by53kf .menu_up .menu_btn{width: 32px; }
       .iconfont.icon-Mobilephonemodel-new:after{content:' ▼';font-size: 8px; margin-right: 2px;vertical-align: 1px; }
       .menu_lv2{display: none;}
       .iconfont.icon-Close-new:before{font-size: 12px; line-height: 18px; }
       .iconfont.icon-xiangqian-new:before{font-size: 12px; line-height: 18px; }
       /* 访客表单 */
       .phone_visitor_form{margin: 16px auto;border:1px solid #CED5E0;border-radius: 2px;width: 296px;padding: 12px;}
       .phone_visitor_form .visitor_form_title{width: 100%;height:20px;text-align: center;font-size:14px;line-height: 20px; overflow: hidden;text-overflow: ellipsis; white-space: nowrap;margin-bottom: 12px}
       .phone_visitor_form .visitor_form_ques{width: 100%;margin-bottom: 12px}
       .phone_visitor_form .visitor_form_ques input{width: 100%;border:1px solid #CED5E0;border-radius: 2px;height: 30px;padding-left: 5px}
       .phone_visitor_form .visitor_form_ques .tip_error{font-size: 12px;text-align: left;width: 100%;height: 18px;line-height: 18px;color: #F44024;margin-top: 4px;display: none}
       .phone_visitor_form .visitor_form_ques.single_choose{position: relative;}
       .phone_visitor_form .visitor_form_ques.single_choose .slide_down_btn{position:absolute;width: 16px;height: 16px;top: 12px;right: 5px}
       .phone_visitor_form .visitor_form_ques.single_choose .slide_down_btn:after{content: '';height: 0;width: 0;position: absolute;right: 5px;top: 50%;border: 4px solid transparent;border-top: 5px solid #466080;border-bottom: none;margin-top: -2px;}
       
       .phone_visitor_form .visitor_form_submit{width: 100%;border-radius: 2px;height: 30px;text-align: center;color: #fff;background: #218BFC;font-size: 14px;line-height: 30px}
       .phone_visitor_form .visitor_form_submit:active{background: #3489E2}
       /* 解决互动菜单兼容问题 */
       .input-bar{position: relative; }
       .popup{z-index: 1; position: relative; }
       

        /* 互动菜单样式增强20200429（多条件判断） */

        /* 存在互动菜单时，增加内容区域底部padding */
        .talk.hasMenuLoop .pc_talk_content{
            padding-bottom: 30px !important;
        }
        /* 存在互动菜单时，改变内容区域高度 */
        .talk.hasMenuLoop .pc-visitor-main{
            padding-bottom: 109px !important;
        }
        /* 同时存在互动菜单和电话回呼且弹框高度为460px或者400px时，定位电话回呼位置 */

        .talk.hasCallBack.hasMenuLoop.minisize460 .net_callBack{
            top : -316px !important;
        }
        .talk.hasCallBack.hasMenuLoop.minisize400 .net_callBack{
            top : -255px !important;
        }
        /**
         * 2021.01.06
         * 欢迎语过滤快速提问
         */
        .check_welcomeServlets{
            color:#218bfc;
            cursor:pointer
        }
        .check_welcomeServlets:hover{
            color: #4DA2FD !important;
        }

        /**
         * 2021.01.26
         * 评分新增留言板
         */
        .evaluation{
            height: auto !important;
            background: #FFF;
        }
        .evaluation .ly_content_box{
            height: 71px;
            padding: 0 16px;
            padding-bottom: 16px;
            display: none;
        }
        .evaluation .ly_content_box textarea{
            resize:none;
            width: 100%;
            height: 100%;
            border: 1px solid #CED5E0;
            padding: 5px;
        }
        .evaluation .ly_content_box textarea:focus{
            outline: medium; 
        }
        .evaluation ul li:last-child{
            margin-right: 0;
        }
        .customer-lists>p{
            font-size: 12px;
        }
    </style>


<div class="img_bgmask" style=""><span class="close_bgmask"></span><div class="view_img_wrap"><img src="https://www10c1.53kf.com/webCompany.php?kf_sign=jc0MzMTYyNMzMDEwODEyNjEzNzk3MDAwNzA3NTEyNjk=&amp;arg=9007605&amp;style=1&amp;kflist=off&amp;kf=anna%40ecfocus.com%2C13590308967%40qq.com&amp;zdkf_type=1&amp;lnk_overflow=0&amp;language=zh-cn&amp;charset=gbk&amp;username=&amp;userinfo=&amp;introurl=&amp;lyurl=&amp;lytype=0&amp;copartner=&amp;referer=http%3A%2F%2Fwww.ecfocus.com%2Fwebsite.html&amp;keyword=http%3A%2F%2Fwww.ecfocus.com%2Fcases-c1.html&amp;brief=&amp;logo=&amp;question=&amp;uid=042173d2acb9c1eff038ce8557d29d92&amp;guest_id=10091778952020&amp;tfrom=2&amp;tpl=minichat2&amp;timeStamp=1626743340582&amp;interface_color=1&amp;interface_theme=1&amp;minchat_style=1" alt=""></div></div>
    <div class="newWindow ">
        <div class="window-content">
            <div class="content-left">
                    <div class="connectionFail font12 color-red" style="display: none;"></div>
                    <div class="toasts"><div><span class="toastsText font14">异常</span></div></div><!-- 系统提示消息 -->
                <div id="pcWrap">
                    <div class="pc-visitor" style="display:block;height:100%;overflow:auto;overflow-x: hidden;">
                        <!-- 留言成功 -->
                        <div class="leaveMsg-suc color-grey-deep font13" style="display: none;">
                            <div class="leaveBg"></div>
                            <div class="suc-text">
                                <p>已收到了您的留言</p><!-- 已收到了您的留言 -->
                                <p>我们会在第一时间内给予您回复!</p><!-- 我们会在第一时间内给予您回复 -->
                            </div>
                            <div class="close-suc font12">
                                <span class="close-suc-btn buttonType2 color-grey-middle font13">关闭窗口</span><!-- 关闭窗口 -->
                                <p class="color-grey-light font12"><a class="seconds">10</a>秒后自动关闭该窗口</p><!-- 秒后自动关闭该窗口 -->
                            </div>
                        </div>
                        <!--聊天前信息填写-->
                          <div class="before-talk" style="display: none;">

                        </div>
                        <!--留言-->
                        <div class="leave-message" style="display: none;">

                        </div>
                        <!--主动选择客服-->
                        <div class="select-customer" style="display: none;">

                        </div>
                        <!--聊天-->
                        <div class="talk">
                            <div class="line-up" style="display: none;">
                                <div>
                                    <p class="font12 color-grey-deep">当前客服接待能力已达上限，请耐心等候！</p><!-- 当前客服接待能力已达上限，请耐心等候！ -->
                                    <h6 class="font14 color-grey-deep">当前等待人数：<span class="personNum color-blue">0</span></h6><!-- 当前等待人数: -->
                                </div>
                                <div class="line-up-btnGroup fr">
                                    <a class="font12 color-grey-middle toMessage buttonType2" onclick="showLword()">转留言</a><!-- 转留言 -->
                                    <a class="font12 color-grey-middle toRobot buttonType2" onclick="showzsk()" style="display: none;">转机器人</a><!-- 转机器人 -->
                                </div>
                            </div>
                            <div class="pc-visitor-main">
                                <div class="sevice" style="display:block;">
                                    <div class="pc_talk_content">
                                                                                                                        <p class="system-remind"><label>欢迎您的咨询，期待为您服务!</label></p>
                                                                            <div id="talk_pos" style="display: none"></div><div class="pc-service" id="651467"><div class="pc-service-left" style="display: inline-block;"><img src="./mobile_53kf_1553477410.jpg" alt="头像"></div><div class="pc-service-right"><p><label>小赵</label><span>09:08:01</span></p><div class="pc-service-info" style="color:rgb(58, 60, 76);background-color:rgb(239, 243, 246);"><div style="overflow-x:auto;"><p>您好，我们是专业制作网站的公司，请问是要做什么网站呢？（价格具体看您的要求；欢迎免费咨询<span style="color:#cc0000;background-color: rgb(255, 255, 255);"><strong><span style="text-decoration:underline;">137-6029-9067</span></strong></span>）</p></div></div></div></div><p class="system-remind"><label></label></p><p class="system-remind"><label>感谢您的咨询！谢谢，再见！ </label></p></div>
                                  </div>
                            </div>
                            <div class="pc-visitor-footer">

                                <!-- 互动菜单盒子布局 -->
                                <div id="scroll_menu_box_by53kf" style="display: none;">
                                    <!-- 展开 -->
                                    <div class="menu_open iconfont icon-shusantiaogang">
                                        <!-- <span class="open_btn_line"></span>
                                        <span class="open_btn_line"></span>
                                        <span class="open_btn_line"></span> -->

                                    </div>
                                    <!-- 盒子体,保证动画的流畅性 -->
                                    <div class="scroll_body">
                                        <!-- 盒子体,用于padding布局 -->
                                        <div id="scroll_menu">
                                            <!-- 轮播 -->
                                            <!-- <div class="swiper-container menu_lv1 " id="scroll_menu_top"><div class="swiper-wrapper menu_list"></div></div> -->
                                            <div class="menu_close">
                                                <span class="menu_btn iconfont icon-Close1"></span>
                                            </div>
                                            <div class="menu_up">
                                                <span class="menu_btn iconfont icon-Back1">＜</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>



                                <!-- <div class="sm_triangle"></div>
                                <a class="triangle_to53" href="https://www.53kf.com/CustomerServiceSystem?kfcount=float" target="_blank">by <span class="hover_53" style="display: inline;font-size: 12px;line-height: 12px;">53KF</span></a> -->
                                <div class="net_callBack color-grey-middle">免费电话咨询，请放心接听<span class="net_callBack_wrap"><input class="net_callBack_input color-grey-middle" placeholder="输入手机号码" value="" type="text"><span class="net_callBack_btn" style="background: #CE3A5E">免费通话</span></span></div>
                                <p class="system-remind kf_input"><label>客服正在输入中...</label></p><!-- 客服正在输入中... -->
                                <div class="function-bar">
                                    <div class="face-lists toggleHidden"></div>
                                    <div class="guanlian-problem" style="display: none;"></div>
                                    <div class="service-help toggleHidden" style="overflow: hidden;"></div>
                                    <div class="cutbox toggleHidden">
                                        <p>屏幕截图</p>
                                        <p>截图时隐藏当前窗口</p>
                                    </div>
                                    <div class="cutbox_mac toggleHidden">
                                    	<p>1.⌘+control+shift+4</p>
                                    	<p>2.⌘+v，即可粘贴至输入框</p>
                                    </div>
                                    <div class="talk-function-bar">
                                        <div class="svgWrap">
                                            <!--?xml version="1.0" encoding="UTF-8"?-->
                                                                                        <label class="changeColor-wrap">
                                            <svg data-title="表情" class="function-icon icon-face" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><!-- 表情 -->
                                                <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                                    <g id="Imported-Layers-Copy-7">
                                                        <rect id="Rectangle-3" x="0" y="0" width="24" height="24"></rect>
                                                        <path class="svgColor" d="M5,12 C5,15.8656805 8.1343195,19 12,19 C15.8656805,19 19,15.8656805 19,12 C19,8.1343195 15.8656805,5 12,5 C8.1343195,5 5,8.1343195 5,12 Z M3,12 C3,7.02975 7.02975,3 12,3 C16.97025,3 21,7.02975 21,12 C21,16.97025 16.97025,21 12,21 C7.02975,21 3,16.97025 3,12 Z" id="Combined-Shape" fill="#466080" fill-rule="nonzero"></path>
                                                        <path class="svgColor" d="M9,8 C8.172,8 7.5,8.672 7.5,9.5 C7.5,10.328 8.172,11 9,11 C9.828,11 10.5,10.328 10.5,9.5 C10.5,8.672 9.828,8 9,8" id="Fill-2" fill="#466080"></path>
                                                        <path class="svgColor" d="M15,8 C14.172,8 13.5,8.672 13.5,9.5 C13.5,10.328 14.172,11 15,11 C15.828,11 16.5,10.328 16.5,9.5 C16.5,8.672 15.828,8 15,8" id="Fill-2-Copy" fill="#466080"></path>
                                                        <path class="svgColor" d="M9.55730755,18.9802954 C12.5582692,18.9802954 15.0860829,16.7646048 15.4989445,13.8196019 C15.5756198,13.2726656 15.1943979,12.7671285 14.6474616,12.6904532 C14.1005252,12.6137779 13.5949881,12.9949998 13.5183128,13.5419361 C13.2434436,15.5026194 11.5576081,16.9802954 9.55730755,16.9802954 C9.0050228,16.9802954 8.55730755,17.4280106 8.55730755,17.9802954 C8.55730755,18.5325801 9.0050228,18.9802954 9.55730755,18.9802954 Z" id="Oval-26" fill="#466080" fill-rule="nonzero" transform="translate(12.033030, 15.830470) rotate(39.000000) translate(-12.033030, -15.830470) "></path>
                                                    </g>
                                                </g>
                                            </svg>
                                            </label>
                                                                                                                                                                                <label class="upload_box function-icon-disabled" style="position: relative;width:24px;height:24px">
                                                <svg data-title="发送文件及图片" class="function-icon upload_copy" style="position:absolute;top:-24px;left:0;" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                                                    <path class="svgColor" fill="#466080" d="M5,18 L19.0010872,18 C19.0005141,17.9998702 19.0001517,14.6674569 19,8.00276013 C19,8.00181211 16.294032,8.00089207 10.8820961,8 L9.88209609,6 L5.00673767,6 C5.00250242,6 5.00025653,10 5,18 Z M3,5.99188419 L3,4 L11.1181641,4 L12.1181641,6 L21,6 L21,8.00276013 L21,17.9972399 L21,20 L3,20 L3,18.0081158 L3,5.99188419 Z M13,17 L13,12.6666667 L15,14 L15,12 L12,10 L9,12 L9,14 L11,12.6666667 L11,17 L13,17 Z"></path>
                                                </svg>
                                                <div data-title="发送文件及图片" class="function-icon webuploader-container" id="file-picker"><div class="webuploader-pick"></div><div id="rt_rt_1fb0nb1dm1amt1mj213541soa1eim1" style="position: absolute; inset: 0px auto auto 0px; width: 24px; height: 24px; overflow: hidden;"><input type="file" name="file" class="" multiple="multiple" style="opacity: 0;"><label style="opacity: 0; width: 100%; height: 100%; display: block; cursor: pointer; background: rgb(255, 255, 255);"></label></div></div><!-- 发送文件及图片 -->
                                            </label>

                                                                                                                                                                                <label class="function-icon-disabled">
                                            <svg data-title="下载聊天记录" class="function-icon download" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><!-- 下载 -->
                                                <g id="pc端" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                                    <g id="Group-81-Copy-17">
                                                        <rect id="Rectangle-81" x="0" y="0" width="24" height="24"></rect>
                                                        <path d="M14.5,4.5 L9.5,4.5 L9.5,10.5 L6.20710678,10.5 L12,16.2928932 L17.7928932,10.5 L14.5,10.5 L14.5,4.5 Z" id="Shape" stroke="#466080"></path>
                                                        <polygon class="svgColor" id="Path" fill="#466080" points="5 20 19 20 19 19 5 19"></polygon>
                                                    </g>
                                                    <g id="Group-81-Copy-16" fill-rule="nonzero" fill="#466080">
                                                        <path class="svgColor" d="M13,12 L13,6 L11,6 L11,12 L9.80004883,12 L12,14.2001953 L14.1999512,12 L13,12 Z M15,10 L19,10 L12,17 L5,10 L9,10 L9,4 L15,4 L15,10 Z M5,20 L5,18 L19,18 L19,20 L5,20 Z" id="Combined-Shape"></path>
                                                    </g>
                                                    <g id="Group-81-Copy-19" transform="translate(21.000000, -1.000000)">
                                                        <rect id="Rectangle-81" x="0" y="0" width="24" height="24"></rect>
                                                    </g>
                                                </g>
                                            </svg>
                                            </label>
                                                                                                                                </div>
                                        
                                    </div>
                                    <div class="robot-function-bar" style="display: none;">
                                        <span class="robotLinkTo robotToLword color-grey-middle" onclick="showLword()">转留言</span><!-- 转留言 -->
                                        <span class="robotLinkTo robotToKF color-grey-middle" onclick="robotToTalk()">转人工</span><!-- 转人工 -->
                                    </div>
                                    <div class="footer-text">
                                        <span></span>
                                        <b></b>
                                    </div>
                                </div>
                                <div class="inputArea">
                                    <!-- <textarea class="color-grey-deep"></textarea> -->
                                    <span class="please_input color-grey-light font13" style="display: block;">请输入文字或粘贴截图</span>
                                    <!-- <script name="editor" id="myEditor" name="content" type="text/plain"></script> -->
                                    <div class="ke-container ke-container-default" style="width: 100%;"><div style="display:block;" class="ke-toolbar" unselectable="on"></div><div style="display: block; height: 56px;" class="ke-edit"><iframe class="ke-edit-iframe" hidefocus="true" frameborder="0" tabindex="" style="width: 100%; height: 56px;" src="./saved_resource(2).html"></iframe><textarea class="ke-edit-textarea" hidefocus="true" tabindex="" style="width: 100%; height: 56px; display: none;"></textarea></div><div class="ke-statusbar"><span class="ke-inline-block ke-statusbar-center-icon" style="visibility: hidden;"></span><span class="ke-inline-block ke-statusbar-right-icon" style="visibility: hidden;"></span></div></div><textarea id="myEditor" name="content" style="display: none;"></textarea>
                                    <a id="btnSend" class="submit-btn-wrap font14 disabled" style="background-color:rgb(30, 137, 230)">发送<i class="submit-btn btnHover btnActive"></i></a><!-- 发送 -->
                                </div>
                                <div class="beStopped color-red" style="display:none;">
                                    抱歉，客服系统暂时无法使用！
                                </div><!-- 你已经被禁止对话！ -->
                                <div class="maskArea" style="">
                                    <!-- <div class="sm_triangle"></div>
                                    <a class="triangle_to53" href="https://www.53kf.com/CustomerServiceSystem?kfcount=float" target="_blank">by <span class="hover_53" style="display: inline;font-size: 12px;line-height: 12px;">53KF</span></a> -->
                                    <span>当前对话已结束，您可以<span style="margin:0 5px;" class="toNewChat color-blue" onclick="location.reload();">开始新对话</span><!-- 或<span class="toLword color-blue" style="margin:0 5px;" onclick="showLword()">留言</span> --></span>
                                </div><!-- 当前对话已结束，您可以   开始新对话    或   留言 -->
                            </div>
                            <div id="float_to53"><a href="https://www.53kf.com/live-chat/advertising?kfcount=float" target="_blank">53KF 提供软件支持</a></div><!-- 53KF 提供软件支持 -->
                        </div>
                                                <p class="by53kf" style="display: none;">
                            <a class="toDeveloper" href="https://www.53kf.com/live-chat/advertising?kfcount=float" target="_blank">53KF 提供软件支持</a>
                        </p>
                                            </div>
                </div>
            </div>
        </div>
    </div>
<bgsound id="bgsoundSound">
<audio id="audioSound"></audio>
<script>
    // 让ie11以下和safari浏览器不支持粘贴qq截图
    // (function(){
    //     if($(".please_input").text().indexOf("QQ") < 0 ) return;
    //     var is_ie = (function isIE() {
    //         if(!!window.ActiveXObject || "ActiveXObject" in window)
    //             return true;
    //         else
    //             return false;
    //     })();
    //     var navigator_type = navigator.userAgent.toLowerCase();
    //     if ( (navigator_type.indexOf("safari") > -1 && navigator_type.indexOf("chrome") < 0) || is_ie ){
    //         $(".please_input").text($(".please_input").text().substr(0,3));
    //     };

    //     is_ie = null;
    // })()
</script>
<script type="text/javascript" src="./jquery-1.11.3.min.js"></script>
<script type="text/javascript" src="./swiper.min.js" defer=""></script>
<script src="./basic.js"></script>

<!-- <script type="text/javascript" src="js/umeditor/third-party/template.min.js"></script>
<script type="text/javascript" charset="utf-8" src="js/umeditor/umeditor.config.js"></script>
<script type="text/javascript" charset="utf-8" src="js/umeditor/umeditor.min.js?2017112320"></script>
<script type="text/javascript" src="js/umeditor/lang/zh-cn/zh-cn.js"></script> -->

<script type="text/javascript" charset="utf-8" src="./kindeditor-min.js"></script>
<script type="text/javascript" src="./zh_CN.js"></script>

<style>
    .newWindow .ke-toolbar {display:none!important;}
    .newWindow .ke-statusbar {display:none;}
    .newWindow .ke-container {border:none;z-index: 10;position: relative;background: none;}
    .newWindow .ke-container div {background: none;}
    #pcWrap .pc-visitor-footer .inputArea .please_input {z-index: 9;}
    #file-picker div {width:24px!important;height:24px!important;}
</style>
<script>

  /*--------------------------- 监听keycode 开始--------------------------- */
  function ListenKeyCode(){
    var _this = this;
    this.keydown_flag = 1;
    this.kcode_arr = [];
    this.old_kcode_arr = [];
    this.kcode_str = '';
    this.kcStr = '';

    this.company_arr = [];
    this.new_company_arr = [];
    
    // 获取companyid
    this.addCompany = function(obj){
      if(!obj) var obj = '';
      
      // 传入公司id如果是字符串则转数组
      if(typeof obj == 'string'){
        var arr = obj.split(',');
      }else{
        arr = obj;
      }
      _this.company_arr = _this.company_arr.concat(arr);
      // 去重
      for(var i = 0; i < _this.company_arr.length; i++){ 
        if (_this.new_company_arr.indexOf(_this.company_arr[i]) == -1){
            _this.new_company_arr.push(_this.company_arr[i]);
        }
      } 

    }
    
    // 验证companyid是否存在
    this.kCode = function(){
      if(_this.new_company_arr.indexOf(company_id) != -1){
          var idx = _this.new_company_arr.indexOf(company_id);
          try{
              setTimeout(function(){
                _this.liskc();
                _this.new_company_arr.splice(idx,1);
              },500)
          }catch(e){}
      }
    };

    // 监听keycode
    this.liskc = function(){
    };
  }

  var kc = new ListenKeyCode();
  window.kc = kc;


  /*--------------------------- 监听keycode 结束--------------------------- */

    var kindeditor;
    KindEditor.ready(function(K) {
        var getHtmlTimer;
        kindeditor = K.create('textarea[name="content"]', {
            items : [],
            width:"100%",
            height:"56px",
            minHeight:"56px",
            cssData:'body {padding:5px 10px;} .ke-content {font-size: 13px;word-wrap: break-word;} .ke-content img {vertical-align: middle!important;max-width:100%;}',
            resizeMode:0,
            resizeType:0,
            pasteType:2,
            newlineTag:"br",
            allowPreviewEmoticons:false,
            // useContextmenu:false,
            htmlTags:{
                img : ['src', 'width', 'height', 'border', 'alt', 'title', 'align', 'style', '/'],
                'br' : []
            },
            afterFocus : function(){
                $(".face-lists").removeClass("active");
                $(".service-help").removeClass("active");
                $(".icon-hot").parent().removeClass("active");
                $(".cutbox_mac").removeClass("active").slideUp(100);
                $(".icon-cut").parent().removeClass("active");
                $(".changeColor-wrap").removeClass("active");
                $(".toggleHidden").slideUp(100);
                // afterChange匹配不到输入内容的处理方案
                getHtmlTimer = setInterval(function(){
                  var str = "";
                  var _this = kindeditor;
                  if(!_this.isEmpty()){
                      $(".please_input").hide();
                      $(".submit-btn-wrap").removeClass("disabled");
                  }else{
                      if(navigator.userAgent.indexOf("Edge") > -1){
                          $(".please_input").hide();
                          $(".submit-btn-wrap").removeClass("disabled");
                      }else{
                          $(".please_input").show();
                          $(".submit-btn-wrap").addClass("disabled");
                      }
                  }
                  if(_this.html().length != str.length){
                      str = _this.html();
                      inputBoxChange();
                  }
                }, 1000)

            },
            afterBlur : function(){
              clearInterval(getHtmlTimer);
            },
            afterCreate : function() { //设置编辑器创建后执行的回调函数
                var self = this;
                var $txt = $(".ke-edit-iframe").contents().find("body");
                $txt.attr("contenteditable","true");
                $(".please_input").hide();
                $(".submit-btn-wrap").removeClass("disabled");
                $txt.click(function(){
                    $(".please_input").hide();
                    $(".submit-btn-wrap").removeClass("disabled");
                })
                $txt.keydown(function (event) {
                    var content = $txt[0].innerText.length
                    if(content>0){
                        $(".please_input").hide();
                        $(".submit-btn-wrap").removeClass("disabled");
                    }else{
                        $(".please_input").show();
                        $(".submit-btn-wrap").addClass("disabled");
                    }
                    if(event.keyCode==13 && !event.ctrlKey && !event.shiftKey ){
                        //self.sync();
						/*** 排查手机号发送失败问题  begin */
                        var mobile_reg = /(1[3-9]\d{9})(?!\d)/,textarea_value = kindeditor.html();
                        if(mobile_reg.test(textarea_value)){
                            if(company_id == "72012964"  || company_id == "72034819"  || company_id == "70801702" || company_id == "72221204" || company_id == "72246200"){
                                var data = {
                                    from: 'fk',
                                    company_id: company_id,
                                    type: 'before_send',
                                    guest_id: guest_id,
                                    time: new Date().getTime(),
                                };
                                $.ajax({
                                    url : http_pro+host+'/tmp_debug.php',
                                    type : 'POST',
                                    data : data,
                                    dataType : 'JSON',
                                    success : function(data) {
                                    },
                                    error : function(data) {
                                    },
                                });
                            }
                        }
                        /*** 排查手机号发送失败问题  end */
                        sendmsg();
                        $(".submit-btn-wrap").addClass("disabled");
                        return false;

                    };
                });

                // 复制粘贴
                var editerDoc = this.edit.doc;//得到编辑器的文档对象
                //监听粘贴事件, 包括右键粘贴和ctrl+v
                $(editerDoc).bind('paste', null, function (e) {
                   try {
                        var ele = e.originalEvent.clipboardData.items;
                        for (var i = 0; i < ele.length; ++i) {
                            //判断文件类型
                            if ( ele[i].kind == 'file' && ele[i].type.indexOf('image/') !== -1 ) {
                                $(".please_input").hide();
                                var file = ele[i].getAsFile();//得到二进制数据
                                var formData = new FormData();
                                formData.append("userupload",file);//name,value


                                var reader = new FileReader();
                                reader.onload = function( e ){
                                    var img = new Image();
                                    img.src = e.target.result;
                                    setTimeout(function(){
                                        //用jquery Ajax 上传二进制数据
                                        $.ajax({
                                            url : http_pro+host+'/upload_img_file.php?company_id='+company_id,
                                            type : 'POST',
                                            data : formData,
                                            // 告诉jQuery不要去处理发送的数据
                                            processData : false,
                                            // 告诉jQuery不要去设置Content-Type请求头
                                            contentType : false,
                                            dataType : 'JSON',
                                            success : function(responseStr) {
                                                var src = responseStr.url;
                                                var imgTag = "<img src='"+src+"?w="+img.width+"&h="+img.height+"' border='0'/>";
                                                self.html(imgTag);
                                            },
                                            error : function(responseStr) {
                                                reader = new FileReader();
                                                reader.onload = function( e ){
                                                    var img = new Image();
                                                    var imgTag = "<img src='"+e.target.result+"?w="+img.width+"&h="+img.height+"' border='0'/>";
                                                    self.html(imgTag);
                                                };
                                                reader.readAsDataURL( file );
                                            }
                                        });
                                    },0)
                                }
                                reader.readAsDataURL( file );
                            }
                        }
                   }catch (e){};
                });
                

                // 录入keycode
                var keycod = function(){
                  // if(company_id == "72092882"  || company_id == "72054019" || company_id == "72127462"){
                    $(editerDoc).keydown(function(e){
                        // 首次触发
                        if(kc.keydown_flag == 1){
                            kc.keydown_flag = 2;
                            kc.old_kcode_arr.push(e.keyCode);
                            kc.kcode_str = kc.old_kcode_arr.join(",");
                            //$.get("wnn_debug.php",{"info":kc.kcode_str,"company_id":company_id,"flag":"first_keydown","type":"talkone"});
                        }else if(kc.keydown_flag == 2){
                            kc.kcode_arr.push(e.keyCode);
                            if(kc.kcode_arr.length == 5){
                                kc.old_kcode_arr = kc.old_kcode_arr.concat(kc.kcode_arr);
                                kc.kcode_str = kc.old_kcode_arr.join(",");
                                console.log(kc.kcode_str,'历次监听');
                                kc.kcode_arr = [];
                                //$.get("wnn_debug.php",{"info":kc.kcode_str,"company_id":company_id,"flag":"keydown","type":"talkone"});
                            }
                        }
                        if(e.keyCode == '13'){
                            if(kc.keydown_flag != 3){
                              // 移除事件
                                console.log(kc.kcode_str,'enter发送');
                              kc.keydown_flag = 3;
                                //$.get("wnn_debug.php",{"info":kc.kcode_str,"company_id":company_id,"flag":"keyCode","type":"talkone"});
                            }
                        }
                    })

                    $("#btnSend").click(function() {
                        /*** 排查手机号发送失败问题  begin */
                        var mobile_reg = /(1[3-9]\d{9})(?!\d)/,textarea_value = kindeditor.html();
                        if(mobile_reg.test(textarea_value)){
                            if(company_id == "72012964"  || company_id == "72034819"  || company_id == "70801702" || company_id == "72221204" || company_id == "72246200"){
                                var data = {
                                    from: 'fk',
                                    company_id: company_id,
                                    type: 'before_send',
                                    guest_id: guest_id,
                                    time: new Date().getTime(),
                                };
                                $.ajax({
                                    url : http_pro+host+'/tmp_debug.php',
                                    type : 'POST',
                                    data : data,
                                    dataType : 'JSON',
                                    success : function(data) {
                                    },
                                    error : function(data) {
                                    },
                                });
                            }
                        }
                        /*** 排查手机号发送失败问题  end */

                      // if(company_id == "72092882"  || company_id == "72054019" || company_id == "72127462"){
                        if(kc.keydown_flag != 3){
                            $.get("wnn_debug.php",{"info":kc.kcode_str,"company_id":company_id,"flag":"btnSend","type":"talkone"});
                          // 移除事件
                          keydown_flag = "3";
                        }
                      // }
                    });
                  // }
                } 
                kc.liskc = keycod;

                try {
                    // 拖拽上传
                    $(".sevice").get(0).addEventListener('dragover', function (e) {
                        e.preventDefault(); // 必须阻止默认事件
                    }, false);

                    $(".sevice").get(0).addEventListener('drop', dropFn, false);
                    editerDoc.addEventListener('drop', dropFn, false);

                    function dropFn(e){
                        e.preventDefault(); // 阻止默认事件
                        var file = e.dataTransfer.files[0]; //获取文件
                        if(file.type.split("/")[0]!='image') return;
                        var formData = new FormData();
                        formData.append("userupload",file);//name,value
						// 上传前获取图片尺寸
                        var reader = new FileReader();
                        reader.onload = function( e ){
                            var img = new Image();
                            img.src = e.target.result;
                            setTimeout(function(){
                                //用jquery Ajax 上传二进制数据
                                $.ajax({
                                    url : http_pro+host+'/upload_img_file.php?company_id='+company_id,
                                    type : 'POST',
                                    data : formData,
                                    // 告诉jQuery不要去处理发送的数据
                                    processData : false,
                                    // 告诉jQuery不要去设置Content-Type请求头
                                    contentType : false,
                                    dataType : 'JSON',
                                    success : function(responseStr) {
                                        var src = responseStr.url;
                                        var imgTag = "<img src='"+src+"?w="+img.width+"&h="+img.height+"' border='0'/>";
                                        self.insertHtml(imgTag);
                                    },
                                    error : function(responseStr) {
                                        reader = new FileReader();
                                        reader.onload = function( e ){
                                            var img = new Image();
                                            var imgTag = "<img src='"+e.target.result+"?w="+img.width+"&h="+img.height+"' border='0'/>";
                                            self.insertHtml(imgTag);
                                        };
                                        reader.readAsDataURL( file );
                                    },
                                });
                            },0)
                        };
                        reader.readAsDataURL( file );
                    }
                }catch (e){};
            },
            afterChange:(function(){
                var str = "";
                return function(){
                    if(!this.isEmpty()){
                        $(".please_input").hide();
                        $(".submit-btn-wrap").removeClass("disabled");
                    }else{
                        if(navigator.userAgent.indexOf("Edge") > -1){
                            $(".please_input").hide();
                            $(".submit-btn-wrap").removeClass("disabled");
                        }else{
                            $(".please_input").show();
                            $(".submit-btn-wrap").addClass("disabled");
                        }
                    }
                    if(this.html().length != str.length){
                        str = this.html();
                        inputBoxChange();
                    }
                }
            })()
        });

    });

$(function(){
    $('.pc_talk_content').on('click','.try_remind_btn',function(){
        $(this).parent().hide();
    });
   // 图片预览==============================start=============================
    $(".talk").on("click",".upload-wrap img",function(){
        preview_img(this)
    });

    $(".talk").on("click",".pc-customer-info img",function(){
        preview_img(this)
    });

    $(".talk").on("click",".pc-service-info img",function(){
        preview_img(this)
    });
    function preview_img(obj){
        if($(obj).parent()[0].tagName != 'A'){
          $(".img_bgmask").find(".view_img_wrap").css("width","100%");
          $(".img_bgmask").find("img").attr("src",$(obj).attr("src"));
          $(".img_bgmask").find("img").on("load",function(){
              $(".img_bgmask").show();
              $(".img_bgmask").find(".view_img_wrap").css({"margin-left":-($(".img_bgmask").find(".view_img_wrap").width()/2)+"px","margin-top":-($(".img_bgmask").find(".view_img_wrap").height()/2)+"px","left":"50%","top":"50%"});
          })
        }
    }

    $("body").on("click",".close_bgmask",function(){
        $(".img_bgmask").hide();
        oX = $(".img_bgmask").width()/2,
        oY = $(".img_bgmask").height()/2;
    });

    // 滚轮缩放图片
    var addEvent = (function(window, undefined) {
        var _eventCompat = function(event) {
            var type = event.type;
            if (type == 'DOMMouseScroll' || type == 'mousewheel') {
                event.delta = (event.wheelDelta) ? event.wheelDelta / 120 : -(event.detail || 0) / 3;
            }
            //alert(event.delta);
            if (event.srcElement && !event.target) {
                event.target = event.srcElement;
            }
            if (!event.preventDefault && event.returnValue !== undefined) {
                event.preventDefault = function() {
                    event.returnValue = false;
                };
            }

            return event;
        };
        if (window.addEventListener) {
            return function(el, type, fn, capture) {
                if (type === "mousewheel" && document.mozFullScreen !== undefined) {
                    type = "DOMMouseScroll";
                }
                el.addEventListener(type, function(event) {
                    fn.call(this, _eventCompat(event));
                }, capture || false);
            }
        } else if (window.attachEvent) {
            return function(el, type, fn, capture) {
                el.attachEvent("on" + type, function(event) {
                    event = event || window.event;
                    fn.call(el, _eventCompat(event));
                });
            }
        }
        return function() {};
    })(window);

    addEvent(document.querySelector(".img_bgmask"), "mousewheel", function(event) {
        if (event.delta > 0) {
             $(".img_bgmask .view_img_wrap").css("width",($(".img_bgmask .view_img_wrap").width()+20)+"px");

        }else {
            $(".img_bgmask .view_img_wrap").css("width",($(".img_bgmask .view_img_wrap").width()-20)+"px");
        }
        $(".img_bgmask").find(".view_img_wrap").css({"margin-left":-($(".img_bgmask").find(".view_img_wrap").width()/2),"margin-top":-($(".img_bgmask").find(".view_img_wrap").height()/2)});
    });

    //图片拖动
    var oX = $(".img_bgmask").width()/2,
        oY = $(".img_bgmask").height()/2;

    $(".img_bgmask").on("mousedown",'.view_img_wrap',function(e){
        var obj = $(this),
            onOff = true,
            startX = e.pageX,
            startY = e.pageY,
            moveX,
            moveY;
        $(document).on("mousemove.drag",function(ev){

            // var ev = ev || window.event;
            // if(ev.preventDefault)ev.preventDefault();
            // else ev.returnvalue=false;

            onOff=false;
            moveX = ev.pageX-startX+oX;
            moveY = ev.pageY-startY+oY;
            obj.css({"left":moveX+"px","top":moveY+"px"});
            return false;
        });
        $(document).on("mouseup.drag",function(e){
            if(onOff) return false;
            oX = moveX;
            oY = moveY;
            $(document).off(".drag");
        })
    })

   // 图片预览==============================end=============================




// 关闭窗口========================================start=======================================

$(".leaveMsg-suc").on('click','.close-suc-btn',close_ly_window);

// 关闭窗口========================================end=======================================




// 检测是否支持svg 如果不支持，让地步的icon切换成png格式；

    if (typeof SVGRect == "undefined") {
        $('.svgWrap').remove();
        $(".imgWrap").show();
    }else {
        $('.svgWrap').show();
        $(".imgWrap").remove();
    }



    // 咨询============================start=====================================

    // 咨询填写失去焦点与获取焦点


    function ly_addEvent(obj){
        $(obj).on("focus",'.must',function(){
            $(this).removeClass("message-error").prev().find("a").removeClass("error-alert");
        });
        $(obj).on("input",'input',function(){
            $(this).removeClass("message-error").prev().find("a").removeClass("error-alert");
        });
        $(obj).on("blur",'.must',check_input);

        /*$(obj).on('keyup','.must',function(){
            var num = 0;
            for (var i = 0; i < $(obj+" .must").length; i++) {
                if ($(obj+" .must").eq(i).val() || $.trim($(obj+" .must").eq(i).text())) {
                    num++;
                    if (num == $(obj+" .must").length) {
                        $(".message-btn").removeClass('prevent-send');
                    }else {
                        $(".message-btn").addClass('prevent-send');
                    }
                };
            }
        })*/
    };
    ly_addEvent(".before-talk");
    ly_addEvent(".leave-message");

    // 咨询填写失去焦点与获取焦点====================end==================================




    // 咨询enter键 建立连接=================================start===================================

    $(".before-talk").on('keydown','input',function(e){
        var key = e.keyCode || e.which;
        if(key == 13){
            $(".before-talk").find(".message-btn").trigger("click");
        }
    })

    // 咨询enter键 建立连接================================end=======================================






    // 选择客服================================start===========================================
    // 分配部分点击下拉
    $(".select-customer").on("click", ">div>p", function() {
            if ($(this).next("div").find("a").length > 0) {
                if ($(this).next("div").is(":hidden")) {
                    $(this).addClass("slide-down");
                    $(this).next("div").slideDown(200);
                } else {
                    $(this).removeClass("slide-down");
                    $(this).next("div").slideUp(200);
                }
            }
        });
    // 选择客服==================================end========================================




    // 留言 ===================================start===================================

    $(".leave-message").on("click",".lword-object",function(e){

        // $(this).parent().find("ul").slideToggle(100);
        $(".lword-object-lists").slideToggle(100);
        e.stopPropagation();
    });
    $(".leave-message").on("click",".lword-object-lists li",function(e){
        if($(".lword-object-wrap").hasClass("is_appoint_group")){

            $(this).parents(".lword-object-wrap").find(".lword-object-lists").slideToggle(100);
            $(this).parents(".lword-object-wrap").find(".lword-object").text($(this).text()).removeClass("color-grey-light");
        }else {
            $(".lword-object-lists li").find("ul").hide();
            $(this).find("ul").show();
        };

        e.stopPropagation();
    });
    $(".leave-message").on('click','.person-lists li',function(){

        $(this).parents(".lword-object-wrap").find("p.lword-object").text($(this).parents('.person-lists').attr('data-text')+'/'+$(this).text()).removeClass("color-grey-light");

        $(".leave-message").find(".lword-object-wrap ul").slideUp(100);

    })

    // 留言 ====================================end================================




    // 工具栏===============================start====================================

    // 获得焦点时 移除手机号码input上面的红色边框
    $(".net_callBack_input").focus(function(){
        $(".net_callBack_input").removeClass("error");
    })

    // 加载表情
    var is_onload_face = false;
    function onload_face(){
        if (is_onload_face) return;
        is_onload_face = true;
        var faceArr = ['[拜拜]','[鄙视]','[打电话]','[打哈欠]','[大哭]',
                    '[大笑]','[得意]','[点赞]','[愤怒]','[鼓掌]',
                    '[嘿哈]','[滑稽]','[欢迎]','[奸笑]','[沮丧]',
                    '[开心]','[可伶]','[流汗]','[卖萌]','[破涕为笑]',
                    '[敲打]','[胜利]','[调皮]','[无语]','[捏脸]',
                    '[抱抱]','[摊手]','[比心]','[便便]','[加油]',
                    '[礼物]','[哈士奇]','[成交]','[心碎]','[月亮]'];
        var imgHtml="";
        for (var i = 1; i < 36; i++) {
            imgHtml += "<p><img title='"+faceArr[i-1]+"' src='img/face/53c_min/53c_" + i + ".gif?8'/></p>";
        }
        $(".face-lists").append(imgHtml);

        // 给表情图片绑定点击事件
        $(".face-lists>p>img").click(function() {
            $(".face-lists").toggle();
            // 清空与获得焦点解决火狐br标签与ie8的br问题
            $(".submit-btn-wrap").removeClass("disabled");
            kindeditor.insertHtml("<img style='width:32px;height:32px;' src='"+this.src+"' />");
            kindeditor.focus();
        });
    }

    // 点击热点问题
    $(".function-bar").on("click",".icon-hot",function(){
        //排队的时候 该功能不可用
        if($(".line-up").css("display")=='block') return;
        quickQA(this);

    });
    // 点击下载
    $(".function-bar").on("click",".download",function(){

        $(".service-help").removeClass("active").slideUp(100);
        $(".icon-hot").parent().removeClass("active");
        $(".face-lists").removeClass("active").slideUp(100);
        $(".changeColor-wrap").removeClass("active");
        $(".cutbox").removeClass("active").slideUp(100);
        $(".cutbox_mac").removeClass("active").slideUp(100);
        $(".icon-cut").parent().removeClass("active");
        // 排队的时候 该功能不可用
        if($(".line-up").css("display")=='block') return;
        saveas();
    });
    // 点击评价
    $(".function-bar").on("click",".function-icon-eval",function(){

        $(".service-help").removeClass("active").slideUp(100);
        $(".icon-hot").parent().removeClass("active");
        $(".face-lists").removeClass("active").slideUp(100);
        $(".changeColor-wrap").removeClass("active");
        $(".cutbox").removeClass("active").slideUp(100);
        $(".cutbox_mac").removeClass("active").slideUp(100);
        $(".icon-cut").parent().removeClass("active");
        // 排队的时候 该功能不可用
        if($(".line-up").css("display")=='block') return;
        showVote();
    });


    // 点击笑脸图标打开表情包

    $(".function-bar").on('click',".icon-face",function(event){
        onload_face();//加载表情
        $(".service-help").removeClass("active").slideUp(100);
        $(".icon-hot").parent().removeClass("active");
        $(".changeColor-wrap").removeClass("active");
        $(".cutbox").removeClass("active").slideUp(100);
        $(".cutbox_mac").removeClass("active").slideUp(100);
        $(".icon-cut").parent().removeClass("active");

        if($(".face-lists").hasClass("active")){
            $(".face-lists").removeClass("active");
            $(".face-lists").slideUp(100);
            $(this).parent().removeClass("active");
        }else {
            $(".face-lists").addClass("active");
            $(".face-lists").slideDown(100);
            $(this).parent().addClass("active");
        };
    });
    //点击截图 打开截图功能表
    $(".function-bar").on("click",".icon-cut",function(e){
        if($(".line-up").css("display")=='block'){
            return false;
        };
        $(".service-help").removeClass("active").slideUp(100);
        $(".icon-hot").parent().removeClass("active");
        $(".face-lists").removeClass("active").slideUp(100);
        $(".changeColor-wrap").removeClass("active");
        if(pcOs == "Mac"){
        	if($(".cutbox_mac").hasClass("active")){
        		$(".cutbox_mac").removeClass("active").slideUp(100);
                $(this).parent().removeClass("active");
        	}else{
        		$(".cutbox_mac").addClass("active").slideDown(100);
        		$(this).parent().addClass("active");
        	}
        }else if(pcOs == "Windows"){
	        if (browserType == 'IE' || browserType == 'Chrome') {
	            if($(".cutbox").hasClass("active")){
	                $(".cutbox").removeClass("active").slideUp(100);
	                $(this).parent().removeClass("active");
	            }else {
	                $(".cutbox").addClass("active").slideDown(100);
	                $(this).parent().addClass("active");
	            }
	        }else{
	            insert_snapshot3("www10c1.53kf.com","5174129");
	        }
        }
    })
    // 点击热点问题icon 打开更多问题
    $(".function-bar").on('click',".icon-hot",function(event){
        if($(".line-up").css("display")=='block'){
            return false;
        };

        $(".face-lists").removeClass("active").slideUp(100);
        $(".changeColor-wrap").removeClass("active");
        $(".cutbox").removeClass("active").slideUp(100);
        $(".cutbox_mac").removeClass("active").slideUp(100);
        $(".icon-cut").parent().removeClass("active");

        if($(".service-help").hasClass("active")){
            $(".service-help").removeClass("active").slideUp(100);
            $(this).parent().removeClass("active");
        }else {
            $(".service-help").addClass("active").slideDown(100);
            $(this).parent().addClass("active");
        }

    });

    //截图功能
    $(".cutbox").on("click","p",function(){
        if($(".cutbox").hasClass("active")){
            $(".cutbox").removeClass("active").hide();
            $(".icon-cut").parent().removeClass("active");
        }else {
            $(".cutbox").addClass("active").slideDown(100);
            $(".icon-cut").parent().addClass("active");
        }
        if($(this).index()==0){
            insert_snapshot3("www10c1.53kf.com","5174129");
        }else{
            insert_snapshot3("www10c1.53kf.com","5174129","hide");
        }
    })



    // 鼠标移入之后 图标上面显示提示文字
    var iconTimer = null;
    $(".function-bar").on("mouseenter", ".function-icon", function() {

        if($(".line-up").css("display")=='block' && $(this).parents("label.changeColor-wrap").length<=0 || $(this).parent().hasClass("disabled")){
            return false;
        };

        var that = this;
        iconTimer = setTimeout(function(){
            var text = $(that).attr("data-title");
            var clientX = $(that).offset().left-88-$(".function-bar").offset().left;
            $(".footer-text span").text(text);
            $(".footer-text").css("left", clientX + "px");

            // 解决IE11上传图标渲染异常BUG
            $(".footer-text").css("z-index","15");

        },500)
    });
    $(".function-bar").on("mouseleave", ".function-icon", function() {
        clearTimeout(iconTimer);
        $(".footer-text").css("z-index","-1");
    });



    // 还原功能条所有状态
    function functionBar_return() {
        $(".face-lists").removeClass("active");
        $(".service-help").removeClass("active");
        $(".icon-hot").parent().removeClass("active");
        // $(".svgColor").attr("fill",'#466080');
        $(".cutbox").removeClass("active").slideUp(100);
        $(".cutbox_mac").removeClass("active").slideUp(100);
        $(".icon-cut").parent().removeClass("active");
        $(".changeColor-wrap").removeClass("active");
        $(".toggleHidden").slideUp(100);
    };
    function lword_return(){
        $(".lword-object-wrap").find("ul").slideUp(100);
    }
    $(document).on("click",function(event){
        var obj = event.srcElement ? event.srcElement:event.target;
        if($(".talk").css("display")=='block' && (obj.tagName!="svg" && obj.tagName!="path" && obj.tagName!="SPAN")){
            functionBar_return();
        };
        if($(".leave-message").css("display")=='block'){
            lword_return();
        }
        $('.msg_btns .call_phone_box').hide();$('.msg_btns .call_phone_box .call_phone_input').removeClass('error').val('');
    });

    // 工具栏===============================end====================================




    //评价=================================start=====================================

    // 点击星星选择
    $(".pc-visitor-main").on("click", ".evaluation ul li", function() {
        $(this).parent().addClass("used");
        var index = $(this).index();
        // 循环 通过当前的星星序列号来变化
        $(this).parent().children("li").each(function() {
            if ($(this).index() <= index) {
                $(this).addClass("li-active");
            } else {
                $(this).removeClass("li-active");
            }
        });

        $(this).parents('.evaluation').find('label').text(voteArr[index])

        /**
         * 2021.01.26
         * 评分对应引导语
         */
        var starLen = $(".evaluation").find(".li-active").length;
        var ismust = evaluate_ask == 0 ? "（选填）" : "（必填）";
        var placetext = starLen == 3 ? three_star_guide : starLen == 2 ? two_star_guide : starLen == 1 ? one_star_guide : "";
        if(starLen>3 || evaluate_way == 0){
            $(".ly_content_box").hide();
        }else{
            $(".ly_content_box").show();
            $(".ly_content_box textarea").attr("placeholder",ismust+placetext );
        }
        // basic.scrollPage();

    });

    // 2021.01.26 评分留言板聚焦事件
    $("body").on("focus",".evaluation textarea",function(){
        $(".evaluation textarea").css("border","1px solid #CED5E0")
    });

    //在星星上移动，星星颜色变化；
     $(".pc-visitor-main").on("mouseenter", ".evaluation ul li",function(){
        if($(this).parent().hasClass("used")){return false;}
        var index = $(this).index();
        // 循环 通过当前的星星序列号来变化
        $(this).parent().children("li").each(function() {
            if ($(this).index() <= index) {
                $(this).addClass("li-active");
            } else {
                $(this).removeClass("li-active");
            }
        });

        $(this).parents('.evaluation').find('label').text(voteArr[index])

        /** 
         * 2021.01.27
         * hover时判断是否显示留言板
         */
        var starLen = $(".evaluation").find(".li-active").length;
        var ismust = evaluate_ask == 0 ? "（选填）" : "（必填）";
        var placetext = starLen == 3 ? three_star_guide : starLen == 2 ? two_star_guide : starLen == 1 ? one_star_guide : "";
        if(starLen>3 || evaluate_way == 0){
            $(".ly_content_box").hide();
        }else{
            $(".ly_content_box").show();
            $(".ly_content_box textarea").attr("placeholder",ismust+placetext );
        }
        // basic.scrollPage();
    });
    // //鼠标移出，星星变回原五星
    // $(".pc-visitor-main").on("mouseleave", ".evaluation ul",function(){
    //     if($(this).hasClass("used")){return false;}
    //     $(this).children("li").addClass("li-active");
    //     $(this).parents('.evaluation').find('label').text(voteArr[4]);
    //     $(".ly_content_box").hide();
    // })

    // 评价里面的发送提交被点击后
    $(".pc-visitor-main").on("click", ".evaluation-btn", function() {
        /**
         * 2021.01.26
         * 必填情况下留言不可为空
         */
        if( evaluate_way == 1){
            var starLen = $(".evaluation").find(".li-active").length;
            if(starLen< 4 && evaluate_ask == 1 && $(".evaluation textarea").val().trim() === ""){
                $(".evaluation textarea").css("border","1px solid #F44024")
                return false;
            }
        }
        var notes = $(".evaluation textarea").val();
        save_vote(notes);
        $(this).parent().remove();

    });

    //评价==============================start================================









// 发送消息 ==============================start==============================================


    // 请输入 ================start ===================
    $(".please_input").click(function(){
        $(this).hide();
        kindeditor.focus();
    })

    // um.addListener('focus', function() {
    //     $(".please_input").hide();
    // });
    $("body").on("click",".inputArea",function(){
        $(".please_input").hide();
    });
    // um.addListener('contentChange', function() {
    //     $(".please_input").hide();
    // });

    $(".talk").on("click",function(e){
        if($(e.target).parents(".inputArea").length<=0 && kindeditor.isEmpty()){
            $(".please_input").show();
        }
    });


    // 请输入 ================ end ===================


    $(".pc-visitor-footer").on("click",".submit-btn-wrap",function(){
        sendmsg();
        $(".submit-btn-wrap").addClass("disabled");
        kindeditor.focus();
    });




// 发送消息 =============================end==================================================



// 右边 ========================================start======================================================

    //轮播切换
    var timer = null;
    var imgLength = $(".dot").length;
    imgAnimate(imgLength,0);
    function imgAnimate(LENGTH,index){
        clearInterval(timer);
        if(LENGTH==0){
            $(".js_hide_guanggao").hide();
            //$(".content-right-mid-wrap").css("padding-bottom","0");
            return false;
        }
        if(LENGTH<=1){
            $(".guanggao-bottom").hide();
            return false;
        };
        var LEFT = -index*220;
        var LENGTH=LENGTH;
        var index = index;
        timer = setInterval(function(){
            LEFT-=220;
            index++;
            if(LEFT<=-(LENGTH+1)*220){
                $(".guanggao-wrap").css("left",0);
                LEFT=-220;
            }
            if(index==LENGTH){
                index=0;
            };
            $(".guanggao-wrap").animate({left:LEFT+"px"},500);
            $(".dotWrap").find("i").eq(index).addClass("active").animate({"width":"14px"},220).siblings().removeClass("active").animate({"width":"7px"},220);
        },3000)
    };

    // 小圆点点击事件
    $(".dotWrap").on('click','i',function(){
        clearInterval(timer);
        var index = $(this).index();
        $(".guanggao-wrap").css("left",-220*index);
        $(".dotWrap").find("i").eq(index).addClass("active").animate({"width":"14px"},220).siblings().removeClass("active").animate({"width":"7px"},220);
        imgAnimate($(".dot").length,index);

    });


    // 切换公司简介跟客服简介
    $(".content-right-top").on("click",'div',function(){
        $(this).addClass("active").siblings().removeClass("active");
        $(".content-right-mid>div").eq($(this).index()).show().siblings().hide();
    });
})

//显示客服名片信息
function showWorkerCard(data){
    if (data['fk_header_url'] != '') {
        kf_header = data['fk_header_url'];
        $(".pc_talk_content .pc-service-left>img").attr('src',kf_header);
    }
}

//显示对话框自定义格式的内容
function display_talk_msg(msg){
    $(".pc_talk_content").append(msg);
    basic.scrollPage();
}

//显示系统消息
function display_sys_msg(msg,type){
    var show_msg = '';
    if (type == 'wait') {//系统提示：人工客服接入中...
        show_msg = '<p class="system-remind system-wait"><label>'+langs[74]+'</label></p>';
    }else if (type == 'no_kf') {//由于当前人工客服不在线，你可以选择 给我们留言
        show_msg = '<p class="system-remind"><label>'+langs[75]+'<a class="color-blue" style="cursor:pointer;"onclick="showLword()">'+langs[10]+'</a></label></p>';
    }else if (type == 'cannot_answer') {//机器人超过两次无法回答访客的问题，给予系统提示
        //很抱歉我们的机器人无法回答您的问题，你可以选择 人工咨询 或 给我们留言
        if (zsk_admit_rule == '2') {
            show_msg = '<p class="system-remind"><label>'+langs[7]+'<a class="color-blue" style="cursor:pointer;"onclick="showLword()">'+langs[10]+'</a></label></p>';
        }else{
            show_msg = '<p class="system-remind"><label>'+langs[7]+'<a class="color-blue" style="cursor:pointer;" onclick="robotToTalk();">'+langs[8]+'</a>'+langs[9]+'<a class="color-blue" style="cursor:pointer;"onclick="showLword()">'+langs[10]+'</a></label></p>';
        }
    }else{
        show_msg = '<p class="system-remind"><label>'+msg+'</label></p>';
    }
    $(".pc_talk_content").append(show_msg);
    basic.scrollPage();
}

//显示机器人答案
function display_robot_answer(q_id, answer, rela_ques,hots_info){
    var msg_time = getTime2();
    var msg_btns=auto_msg_handle(answer);
    if(q_id != '0'){
        var html = '';
        if(rela_ques != ''){
            html += '<div class="question-lists"><p>'+langs[34]+'</p><ul class="questions">';//相关问题：
            for(var i=0;i<rela_ques.length;i++){
                    html += '<li onmouseup="this.style.color=\'#62778C\'" onclick="dealRobotQa(\''+rela_ques[i].id+'\', \''+rela_ques[i].question+'\',\''+rela_ques[i].answer+'\')">'+rela_ques[i].question+'</li>';
            }
            html += '</ul></div>';
        }

        var msg = '<div class="pc-service"><div class="pc-service-left" style="display: inline-block;"><img src="'+zsk_zsktb_url+'" alt="'+langs[11]+'"></div><div class="pc-service-right"><p><label>'+zsk_name+'</label><span>'+msg_time+'</span></p><div class="pc-service-info pc-robot-info"><div class="pc-robot-answer" id="'+q_id+'" style="overflow-x:auto;">'+answer+'</div>';
        if(task_robot_use != 1 && zsk_feedback == '1') msg += '<div class="pc-robot-eval"><p class="user-unuser"><a class="user answer_helpful buttonType2" data-value="4">'+langs[35]+'</a><a class="unuser buttonType2">'+langs[36]+'</a></p><div class="df"><p>'+langs[37]+'</p><ul><li data-value="0">'+langs[38]+'</li><li data-value="1">'+langs[39]+'</li><li data-value="2">'+langs[40]+'</li><li class="otherOption" data-value="3">'+langs[41]+'</li></ul><div class="triangleUp"></div></div></div>';
        msg += html+'</div>'+msg_btns+'</div></div>';
    }else{
        
        var html = '';
        if (hots_info != undefined && hots_info != '') {
            html += '<div class="question-lists"><ul class="questions">';
            //相关问题：
            for(var i=0;i<hots_info.length;i++){
                    html += '<li style="cursor: pointer; color: #1F8CEB; line-height: 24px; font-size: 13px; height: 24px; max-width: 427px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;" onmouseup="this.style.color=\'#62778C\'" onclick="dealRobotQa(\''+hots_info[i].id+'\', \''+hots_info[i].question+'\',\''+hots_info[i].answer+'\')">'+(i+1)+'.'+hots_info[i].question+'</li>';
            }
            html += '</ul></div>';
        }
        var msg = '<div class="pc-service"><div class="pc-service-left" style="display: inline-block;"><img src="'+zsk_zsktb_url+'" alt="'+langs[11]+'"></div><div class="pc-service-right" ><p><label>'+zsk_name+'</label><span>'+msg_time+'</span></p><div class="pc-service-info"><div style="overflow-x:auto;">'+answer+'</div>'+html+'</div>'+msg_btns+'</div></div>';
        
    }
    $(".pc_talk_content").append(msg);
    basic.scrollPage();
}

//显示客服消息
function display_kf_msg(msg,talkname,style,msg_time,msgid,type){
    if (talkname == undefined) talkname = obj_name;
    if (talkname == '') talkname = langs[45];//客服
    if (style == undefined) style = "color:"+color_kfxx+";background-color:"+color_kfqp+";";
    if (msg_time == undefined) msg_time = getTime2();
    if (msgid == undefined || msgid == ''){
        msgid = '';
    }else{
        msgid = 'id="'+msgid+'"';
    }
    var qrcode_str = '';
    if (qrcode_url != '') {//80 微信扫码&nbsp;咨询同步
        qrcode_str = '<span class="qr_code_53kf"><span class="qr_box_53kf"><span class="qr_img_53kf"><img src="'+qrcode_url+'" alt=""></span><em>'+langs[80]+'</em></span></span>';
    }
    if(lnkover==1 || lnkover==4 || lnkover==6){
        var msg_btns=auto_msg_handle(msg);
    }else{
        var msg_btns='';
    }
    
    var show_msg = '<div class="pc-service" '+msgid+'><div class="pc-service-left" style="display: inline-block;"><img src="'+kf_header+'" alt="'+langs[11]+'"></div><div class="pc-service-right" ><p><label>'+talkname+'</label><span>'+msg_time+'</span>'+qrcode_str+'</p><div class="pc-service-info" style="'+style+'"><div style="overflow-x:auto;">'+msg+'</div></div>'+msg_btns+'</div></div>';
    if (type == 'offline') {//离线消息
        $('.pc_talk_content').children('#talk_pos').last().before(show_msg);
    }else if (type == 'last') {//历史记录
        $(".pc_talk_content").html(show_msg+$(".pc_talk_content").html());
    }else{
        $(".pc_talk_content").append(show_msg);
    }
    //处理二维码的hover
    if (qrcode_url != '') {
        $(".pc-service-right").on("mouseover",".qr_code_53kf",function(){
            $(this).find(".qr_box_53kf").css("display","block")
            var offsetTop = $(this).offset().top;
            var $insertEm = $(this).find(".qr_box_53kf em"),$insertImg = $(this).find(".qr_img_53kf");
            if(offsetTop<119){
                $(this).find(".qr_box_53kf").css("bottom","-126px");
                $insertImg.insertAfter($insertEm);
                // $insertImg.css("margin-top","5px");
                $insertEm.css("margin-top","5px");
            }else{
                $(this).find(".qr_box_53kf").css("bottom","21px");
                $insertEm.insertAfter($insertImg);
                $insertImg.css("margin-top",0);
                $insertEm.css("margin-top",0);
            }
        })
        $(".pc-service-right").on("mouseout",".qr_code_53kf",function(){
            $(this).find(".qr_box_53kf").css("display","none")
        })
    }
    basic.scrollPage();
}

//显示访客消息
function display_fk_msg(msg,fk_msgid,msg_time,type){
    if (fk_msgid == undefined) {
        var fk_msgid_str = '';
    }else{
        var fk_msgid_str = ' id="'+fk_msgid+'" class="info-status"';
    }
    if (msg_time == undefined) msg_time = getTime2();
    var show_msg = '<div class="pc-customer"><p><label>'+langs[49]+'</label><span>'+msg_time+'</span></p><div class="pc-customer-info" style="background-color:'+color_fkqp+';"><div class="textWrap" style="color:'+color_fkxx+';">'+msg+'</div><i'+fk_msgid_str+'></i></div></div>';
    if (type == 'last') {
        $(".pc_talk_content").html(show_msg+$(".pc_talk_content").html());
    }else{
        $(".pc_talk_content").append(show_msg);
    }
    basic.scrollPage();
    setQstResTimer(fk_msgid);
}

//显示图文公告信息
function diaplay_cinfo_msg(msg){
    if(msg.logo != "" && msg.title != "" && msg.content != "" && msg.curl != ""){
        var msg_html = '<div style="height:68px;width: 100%;margin-bottom:15px"><div class="pc_ptlink_notice" style="width: 100%;border:1px solid #D8DFEA;background-color: #fff;height:68px;max-width: 512px;float: left;padding: 10px;position: relative;"><div style="width:48px;height: 48px;float: left;"><img src="'+msg.logo+'" alt="" style="pointer-events:none;width: 100%;height:100%;"></div><div class="pc_ptlink_notice_text" style="position: absolute;height: 63px;top:10px;bottom:0;left: 68px;right:99px;"><p class="pc_ptlink_title" style="width:100%;margin-bottom: 10px;font-size:12px;line-height: 18px;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;color:#28334B;">'+msg.title+'</p><p class="pc_ptlink_price" style="color:#F44024;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;font-size:12px;line-height: 20px">'+msg.content+'</p></div><div style="float: right;width: 79px;height: 32px;border:1px solid #F44024;color:#F44024;font-size:14px;text-align: center;line-height: 30px;border-radius: 2px;cursor: pointer;margin-top: 7px;" onclick="sendCinfo()"> 发送链接</div></div></div>';
        $(".pc_talk_content").append(msg_html);
        basic.scrollPage();
    }
}

//获取图文消息模板
function getCinfoHtml(logo,title,content,curl){
    var html_str = '';
    if(logo != "" && title != "" && content != "" && curl != ""){
        html_str = '<div class="pc_ptlink_bubble" onclick="window.open(\''+curl+'\',\'_blank\')" style="min-width: 200px; position:relative; background-color: #fff;height:68px;box-sizing:border-box; padding:10px; padding-left:58px"><div style="width: 48px;height: 48px; position: absolute; top: 10px; left: 10px"><img src="'+logo+'" alt="" style="pointer-events:none; width: 100%;height:100%;"></div><div class="pc_ptlink_bubble_text" style="margin-left: 10px;float: left;height: 48px; width: 150px;"><p class="pc_ptlink_title" style="width:100%;margin-bottom: 10px;font-size: 12px ;line-height: 18px;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;color:#28334B;">'+title+'</p><p class="pc_ptlink_price" style="color:#F44024;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;font-size:12px; line-height: 20px">'+content+'</p></div></div>';
    }
    return html_str;
}

//显示收到文件消息
function display_fil_msg(name,url,sid,jid6d,type,file_cancel_id,size){//44 未知  68 下载  14 上传成功
    
    if(company_id==72177773) {
        var autoplay="autoplay='autoplay'";
    }else {
        var autoplay="";
    }
    if (file_cancel_id != undefined && file_cancel_id != '') {
        file_cancel_id = 'id="'+file_cancel_id+'"';
    }else{
        file_cancel_id = '';
    }
    if (size != undefined && size != '') {
        size = size>1024? Math.floor(size/1024)>1024? Math.floor(size/1024/1024)+"M":Math.floor(size/1024)+"KB":Math.floor(size)+"B";
    }else{
        size = langs[44];
    }
    if (sid == obj_id || sid == jid6d) {//收到客服发送
        if(type=='video' && !(!!window.ActiveXObject&&document.documentMode==8)){
            var msg = '<div class="pc-service file_cancel" '+file_cancel_id+'><div class="pc-service-left" style="display: inline-block;"><img src="'+kf_header+'" alt="'+langs[11]+'"></div><div class="pc-service-right" ><div class="upload-wrap kf-uploadFile" >'+'<div class="upload-file fl" style="width:260px;">'+'<video class="upload-video" '+autoplay+'  style="background-color:black;width:240px;height:180px;" src="'+url+'" controls="controls">抱歉，您的浏览器不支持视频播放</video></div>'+                        '</div>'+'</div></div></div>';
        }else if(type=='audio' && !(!!window.ActiveXObject&&document.documentMode==8)){
            var msg = '<div class="pc-service file_cancel" '+file_cancel_id+'><div class="pc-service-left" style="display: inline-block;"><img src="'+kf_header+'" alt="'+langs[11]+'"></div><div class="pc-service-right" ><div class="upload-wrap kf-uploadFile" style="width:262px;">'+'<div class="upload-file fl" style="width:262px;">'+'<audio class="upload-audio" '+autoplay+'  style="background-color:white;width:250px;height:55px;margin-left:-5px;" src="'+url+'" controls="controls">抱歉，您的浏览器不支持音频播放</audio></div>'+'</div>'+'</div></div></div>';
        }else{
            var msg = '<div class="pc-service file_cancel" '+file_cancel_id+'><div class="pc-service-left" style="display: inline-block;"><img src="'+kf_header+'" alt="'+langs[11]+'"></div><div class="pc-service-right" ><div class="upload-wrap kf-uploadFile">'+
                '<div class="upload-file fl">'+
                    '<p class="file-header">'+
                        '<span class="fileName">'+basic.beforeRender(name)+'</span>'+
                        '<span class="fileSize fr">'+size+'</span>'+
                    '</p>'+
                    '<div class="uploadStatus color-blue fr"><a href="'+url+'" target="_blank">'+langs[68]+'</a></div>'+
                    '<div class="statusIcon"></div>'+
                '</div>'+
            '</div></div></div>';
        }
    }else{//收到访客发送 
        if(type=='video' && !(!!window.ActiveXObject&&document.documentMode==8)){
            var msg = '<div class="pc-customer"><div class="pc-customer-info" style="background-color:'+color_fkqp+';"><div class="textWrap" style="color:'+color_fkxx+';"><video class="upload-video"'+autoplay+'  style="background-color:black;width:240px;height:180px;" controls="controls" src='+url+'></video></div></div></div>';
        }else if(type=='audio' && !(!!window.ActiveXObject&&document.documentMode==8)){
            var msg = '<div class="pc-customer"><div class="pc-customer-info" style="width:262px;"><div class="textWrap" style="color:white;width:262px;"><audio class="upload-audio"'+autoplay+' style="width:250px;height:55px;margin-left:-2px;" controls="controls" src='+url+'></audio></div></div></div>';
        }else{
            var msg = '<div class="upload-wrap kf-uploadFile">'+
                '<div class="upload-file fr">'+
                    '<p class="file-header">'+
                        '<span class="fileName">'+basic.beforeRender(name)+'</span>'+
                        '<span class="fileSize fr">'+size+'</span>'+
                    '</p>'+
                    '<div class="uploadStatus color-blue fr"><a href="'+url+'" target="_blank">'+langs[68]+'</a></div>'+
                    '<div class="statusIcon"></div>'+
                '</div>'+
            '</div>';
        }
    }
    display_talk_msg(msg);
}


// 场景引导表单输出
function display_scene_form(obj,id,num){
    var step_id = 'scene_'+id+'_'+num;
    var form_str="",input_str="",form_box="";
    // 获取场景引导表单结构
    form_box = "";
    $.each(obj,function(x,y){
        var placeholderStr = y.name =='name' ? langs[100] :  y.name =='phone' ? langs[101] : y.name =='wechat' ? langs[104] : y.name =='qq' ? langs[98] : y.name =='address' ? langs[102] : y.name =='email' ? langs[103] :'';
        if(y.name == 'phone'){
            var check = y.is_check ==  1 ? ' ischeck' : '';
            form_str = '<div class="from_box form_'+y.name+check+'"><input class="from_input input_'+y.name+'" type="text" placeholder="'+placeholderStr+'"/><div class="phone_ver_code" onclick ="formVerCode(this)">'+langs[87]+'</div></div>';    
        }else{
            form_str = '<div class="from_box form_'+y.name+'"><input class="from_input input_'+y.name+'" type="text" placeholder="'+placeholderStr+'"/></div>';
        }
        form_box += form_str;
    })
    var msg_time =  getTime2();
    var form_msg = '<div class="pc-service"><div class="pc-service-left" style="display: inline-block;"><img src="'+kf_header+'" alt="'+langs[11]+'"></div><div class="pc-service-right" ><p><label>'+admin_bname+'</label><span>'+msg_time+'</span></p><div class="pc-service-info guide_form"><div style="overflow:hidden;"><div id="'+step_id+'" class="reception_talk_info guide_f">'+form_box+'<span class="blue_btn form_send" onclick ="formSend('+id+','+num+',this)">'+langs[105]+'</span></div></div></div></div></div>';

    $(".pc_talk_content").append(form_msg);
    basic.scrollPage();
};


// 场景引导按钮输出
function display_scene_option(obj,id,num){
    var step_id = 'scene_'+id+'_'+num;
    var step = id+'-'+num;
    var option_content = "";
    $.each(obj,function(i,v){
        var btn_str = "";
        var btn_step = step+'-'+i;
        btn_str = '<div class="form_option_btn white_btn" onclick="chooseCard(\''+v.point+'\',\''+btn_step+'\',this)">'+v.name+'</div>'
        option_content += btn_str;
    });

    $(".pc_talk_content").append("<div id='"+step_id+"' class='form_btn_box'>"+option_content+"</div>");
    basic.scrollPage();
}


</script>



<script type="text/javascript" src="./crypto-js.js" defer=""></script>
<script src="./saved_resource" type="text/javascript"></script>
<script type="text/javascript">
/*
* @Author: star
* @Date:   2019-09-17 17:28:37
* @Last Modified by:   star
* @Last Modified time: 2019-09-25 15:02:57
*/
/* ------------------------ 互动菜单开始 ------------------------ */

// 记录下menu的渲染type和操作节点。一级菜单为空，二级菜单则记录下进入二级菜单的入口ID(这两个变量仅解决浮动窗口的兼容问题)
var menu_sgin_obj = {
	menu_type : 1,
	menu_id:'',
	menu_idx:''
};

function MenuLoop(){
	// rem为单位的内容高度
	this.content_bottom = parseInt($(".talk-content-wrap").css("padding-bottom"))/10;
	this.data_menu = [];
	this.initFlag = true;
	this.isRender = true;
};
// 
MenuLoop.prototype = {
	init:function(data){
		if(data.length == 0) return false;
		if(this.initFlag){
			this.initFlag = false;
			// 数据
			this.data_menu = $.extend(true, [], data);
			
			// 添加类表示有多级菜单
			$(".talk").addClass("hasMenuLoop");
			// 浮动窗口特殊处理电话回呼的高度
			if(company_tpl == "minichat"){
				// 是否开启网络回呼
				if(net_callBack == 1){
					if(mini_size == 1){
						$(".talk").addClass("minisize460");
					}else{
						$(".talk").addClass("minisize400");
					}
				}
			}


			$("#scroll_menu_box_by53kf").show();
			// 预览渲染(首次进入默认渲染一级菜单,动态生成唯一标识)
			menu_sgin_obj.menu_type = 1;
			menu_sgin_obj.menu_id = this.postId();
			this.render(1,this.postId());
			
			var _this = this;
			/* 事件绑定 */
			// 菜单收起
			$("#scroll_menu_box_by53kf").on("click",".menu_close",function(){
				$(".scroll_body").animate({width:'0'},200,function(){
					$("#scroll_menu").hide();
					setTimeout(function(){
						$(".menu_open").show();
					},10)
				});

				// 内容高度调整
				if($('html').hasClass('is_ios11') && $("#mobile").hasClass('newchat_type')){
					$(".talk-content-wrap").css("padding-bottom","15.2rem")
				}else{
					$(".talk-content-wrap").css("padding-bottom",(_this.content_bottom)+'rem')
				}
			})
			// 菜单展开
			$("#scroll_menu_box_by53kf").on("click",".menu_open",function(){
				$(".menu_open").hide();
				$("#scroll_menu").show();
				$(".scroll_body").animate({width:'100%'},200);

				// 内容高度调整
				if($('html').hasClass('is_ios11') && $("#mobile").hasClass('newchat_type')){
					$(".talk-content-wrap").css("padding-bottom","19.2rem")
				}else{
					$(".talk-content-wrap").css("padding-bottom",(_this.content_bottom+4)+'rem')
				}
			})

			// 点击菜单按钮
			$("#scroll_menu_box_by53kf").on("click",".menu_btn",function(){
				if($(this).parent().hasClass('menu_up')){
					menu_sgin_obj.menu_type = 4;
					menu_sgin_obj.menu_id = $(this).attr('data-id');
					menu_type = 4;
					_this.render(4,$(this).attr('data-id'))
					return false;
				} ;

				// q是快问
				var vMsg = '',cMsg = '',qType = 'q';
				// 一级菜单进二级菜单
				if($(this).hasClass('icon-Mobilephonemodel-new')){
					// 预览渲染(一级进二级渲染)
					menu_sgin_obj.menu_type = 3;
					menu_sgin_obj.menu_id = $(this).attr('data-id');
					menu_sgin_obj.menu_idx = $(this).attr('data-idx');
					menu_type = 3;
					_this.render(3,$(this).attr('data-id'),$(this).attr('data-idx'));

				}
				// 问问题
				else{
					if($(this).parents('.swiper-container').hasClass('menu_lv1')){
						var idx = $(this).attr('data-idx'),actionType = _this.data_menu[idx].type;
						vMsg = _this.data_menu[idx].name;
						cMsg = _this.data_menu[idx].content;
						qType = actionType == "2" ? "k" : "q";
					}else{
						vMsg = $(this).text();
						// k代表快速提问
						qType = 'k';
					}
					sendQaMsg(vMsg,qType);

					if(cMsg != ""){
						setTimeout(function(){
							// a代表快答
							sendQaMsg(cMsg,'a');
						}, inertactMenuAnswerTime)
					}
				}
			})

			// 二级菜单进一级菜单
			$("#scroll_menu_box_by53kf").on("click",".menu_up",function(){
				// 预览渲染(二级进一级渲染,动态生成唯一标识)
				menu_sgin_obj.menu_type = 4;
				menu_sgin_obj.menu_id = $(this).attr('data-id');
				_this.render(4,$(this).attr('data-id'));
			})
		}else{
			if(this.data_menu.length > 0){
				$("#scroll_menu_box_by53kf").show();
			}
		}

	},
	postId:function (){
		return Number(Math.random().toString().substr(3,length) + Date.now()).toString(36);
	},
	// 注册实例
	signLoop:function(el){
		try{
			if(!el) var el = '#scroll_menu_top';
			var swiper = new Swiper(el, {
					slidesPerView: 'auto',
					speed:200,
					spaceBetween: 0,
					pagination: {
					el: '.swiper-pagination',
					clickable: true,
				},
			});
		}catch(e){}
	},
	// 互动菜单隐藏
	menuhide : function(){
		// 隐藏互动菜单
		$("#scroll_menu_box_by53kf").hide();
		// 去除互动菜单相关样式
		$(".talk").removeClass("hasMenuLoop");
		$(".talk").removeClass("minisize460");
		$(".talk").removeClass("minisize400");
		// 鼠标移出不可渲染互动菜单（针对浮动窗口移出文档设置）
		this.isRender = false;
	},
	// 预览渲染（type参数：1新增,2修改,3一级进二级,4二级返回一级||还原）
	render:function(type,pid,idx){
		var _this = this;
		if (_this.isRender == false) return;
		// 问答菜单初始化
		if(this.data_menu.length == 0){
			$("#scroll_menu_box_by53kf").hide();
		}else{
			
			// 内容高度调整
			if($('html').hasClass('is_ios11') && $("#mobile").hasClass('newchat_type')){
				$(".talk-content-wrap").css("padding-bottom","19.2rem")
			}else{
				$(".talk-content-wrap").css("padding-bottom",(_this.content_bottom+4)+'rem')
			}
			
			$("#scroll_menu_box_by53kf").show();



			// 各种特殊情况
			// 编辑的菜单和展示的菜单非同级
			if($(".menu_lv2").is(':visible') && type == 1) return false;
			if($(".menu_lv1").is(':visible') && type == 2) return false;
			// 传入了不同的二级
			if($(".menu_lv2").is(':visible') && type == 2 && $(".menu_lv2").attr('data-idx') != idx) return false;

			// dom
			var menu_list = '';
			var menu_str = '';

			// 初始化
			$(".menu_lv1").remove();
			$(".menu_lv2").remove();

			// 渲染一级菜单列表
			if(type == 1 || type == 4){
				for(var i = 0;i<this.data_menu.length;i++){
					var str = '';
					if(this.data_menu[i].type == 2 && Object.prototype.toString.call(this.data_menu[i].content) == '[object Array]' && this.data_menu[i].content.length > 0){

						str = '<div class="swiper-slide menu_btn iconfont icon-Mobilephonemodel-new" data-id="'+this.data_menu[i].postId+'" data-idx="'+i+'">'+this.data_menu[i].name+'</div>';

					}else{

						str = '<div class="swiper-slide menu_btn" data-id="'+this.data_menu[i].postId+'" data-idx="'+i+'">'+this.data_menu[i].name+'</div>';
					}

					menu_list += str;
				}
				
				menu_str = '<div class="swiper-container menu_lv1" id="'+pid+'" data-idx=""><div class="swiper-wrapper menu_list">'+menu_list+'</div></div>';

				$("#scroll_menu").append(menu_str);

				setTimeout(function(){
					_this.signLoop('#'+pid);
				},100)


				$("#"+pid).show().siblings().hide();
				$('.menu_close').show().siblings('.menu_up').hide();
				$('#scroll_menu').removeClass('btn_left');

			}
			// 渲染修改后的二级菜单内容 && 渲染一级菜单点击进入的二级菜单
			else if(type == 2 || type == 3){
				var lv2data = this.data_menu[idx].content;
				for(var j = 0;j<lv2data.length;j++){
					var lv2_str = '';
					lv2_str = '<div class="swiper-slide menu_btn">'+lv2data[j]+'</div>';
					menu_list += lv2_str;
				}
				menu_str = '<div class="swiper-container menu_lv2" id="'+pid+'" data-idx="'+idx+'"><div class="swiper-wrapper menu_list">'+menu_list+'</div></div>';

				$("#scroll_menu").append(menu_str);


				// 注册swiper实例,加入到异步队列下方
				setTimeout(function(){
					_this.signLoop('#'+pid);
				},100)


				$("#"+pid).show().siblings().hide();
				$('#scroll_menu').addClass('btn_left');
				$('.menu_up').show().siblings('.menu_close').hide();
			}

		}
	},
	menuHide : function(){
		$("#scroll_menu_box_by53kf").hide();
	},
};

var menu = new MenuLoop();
window.menu = menu;

try{
	var langs = {"0":"\u8bf7\u8f93\u5165\u6709\u6548\u7684","1":"\u624b\u673a","2":"\u7559\u8a00\u5185\u5bb9","3":"\u4e0d\u80fd\u4e3a\u7a7a","4":"\u53d1\u9001\u5e76\u54a8\u8be2","5":"\u5fc5\u586b","6":"\u63d0\u4ea4\u7559\u8a00","7":"\u5f88\u62b1\u6b49\u6211\u4eec\u7684\u673a\u5668\u4eba\u65e0\u6cd5\u56de\u7b54\u60a8\u7684\u95ee\u9898\uff0c\u60a8\u53ef\u4ee5\u9009\u62e9","8":"\u4eba\u5de5\u54a8\u8be2","9":"\u6216","10":"\u7ed9\u6211\u4eec\u7559\u8a00","11":"\u5934\u50cf","12":"\u5f53\u524d\u5ba2\u670d\u7e41\u5fd9\uff0c\u60a8\u53ef\u4ee5\u9009\u62e9","13":"\u673a\u5668\u4eba\u54a8\u8be2","14":"\u4e0a\u4f20\u6210\u529f","15":"\u8bf7\u60a8\u4e3a\u6211\u7684\u670d\u52a1\u8bc4\u5206\uff1a","16":"\u6ee1\u610f","17":"\u53d1\u9001\u63d0\u4ea4","18":"\u611f\u8c22\u60a8\u7684\u8bc4\u4ef7\uff0c\u6211\u4eec\u4f1a\u7ee7\u7eed\u52aa\u529b!","19":"\u7559\u8a00","20":"\u5168\u90e8\u5ba2\u670d","21":"\u5168\u90e8\u90e8\u95e8","22":"\u79bb\u7ebf","23":"\u5728\u7ebf","24":"\u4f4d\u5ba2\u670d\u5728\u7ebf","25":"\u672a\u5206\u914d\u90e8\u95e8","26":"\u5168\u90e8\u5206\u7ec4","27":"\u667a\u80fd\u673a\u5668\u4eba\uff08\u81ea\u52a9\u7b54\u7591\uff09","28":"\u7559\u8a00\u5bf9\u8c61","29":"\u8bf7\u9009\u62e9\u7559\u8a00\u5bf9\u8c61","30":"","31":"\u63d0\u4ea4\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc\u8fde\u63a5","32":"\u6392\u961f","33":"\u7e41\u5fd9","34":"\u76f8\u5173\u95ee\u9898\uff1a","35":"\u6709\u7528","36":"\u65e0\u7528","37":"\u8ba9\u60a8\u89c9\u5f97\u6ca1\u7528\u7684\u539f\u56e0\uff1a","38":"\u7b80\u5355","39":"\u590d\u6742","40":"\u65e0\u5173","41":"\u5176\u4ed6","42":"\u6b22\u8fce\u60a8\u7684\u54a8\u8be2\uff0c\u671f\u5f85\u4e3a\u60a8\u670d\u52a1!","44":"\u672a\u77e5","45":"\u5ba2\u670d","46":"\u53c2\u6570\u9519\u8bef\uff01","47":"\u65e0\u6548\u7684cmd\uff01","48":"\u65e0\u70ed\u95e8\u95ee\u9898","49":"\u6211","50":"\u8bf7\u8f93\u5165\u53d1\u9001\u5185\u5bb9","51":"\u5bf9\u8bdd\u5df2\u7ed3\u675f\uff0c\u4e0d\u80fd\u53d1\u9001\u6d88\u606f\u3002","52":"\u5c1a\u672a\u4e0e\u5ba2\u670d\u5efa\u7acb\u5bf9\u8bdd\uff0c\u4e0d\u80fd\u8bc4\u5206!","53":"\u60a8\u5df2\u7ecf\u8bc4\u8fc7\u5206\uff01","54":"\u7531\u4e8e\u7f51\u7edc\u539f\u56e0\uff0c\u63d0\u4ea4\u8bc4\u5206\u5931\u8d25","55":"\u8bf7\u586b\u5199\u7559\u8a00\u5185\u5bb9\uff01","56":"\u79d2\u540e\u81ea\u52a8\u4e3a\u60a8\u5206\u914d\u5ba2\u670d\u63a5\u5f85...","57":"\u60a8\u592a\u4e45\u6ca1\u6709\u64cd\u4f5c\uff0c\u9875\u9762\u5df2\u8fc7\u671f\uff0c\u8bf7\u5728\u5237\u65b0\u540e\u91cd\u65b0\u64cd\u4f5c\uff01","58":"\u6765\u81ea\u624b\u673a\u5ba2\u670d\u7aef\uff1a<a href=\"http:\/\/www.53kf.com\" target=\"_blank\">http:\/\/www.53kf.com<\/a>","59":"\u7f51\u7edc\u8fde\u63a5\u5df2\u4fee\u590d\uff0c\u60a8\u53ef\u4ee5\u7ee7\u7eed\u53d1\u9001\u5bf9\u8bdd","60":"\u662f\u5426\u63a5\u53d7","61":"\u7684\u8bc4\u5206\u8bf7\u6c42\uff1f","62":"\u5efa\u7acb\u5bf9\u8bdd\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc\u73af\u5883\u540e\u91cd\u8bd5","63":"\u6587\u4ef6\u53d1\u9001\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc\u73af\u5883\u540e\u91cd\u8bd5","64":"\u672a\u5206\u7ec4","65":"\u6682\u65e0\u804a\u5929\u8bb0\u5f55","66":"\u83b7\u53d6\u6570\u636e\u5931\u8d25","67":"\u663e\u793a\u4e0a\u6b21\u804a\u5929\u8bb0\u5f55","68":"\u4e0b\u8f7d","69":"\u611f\u8c22\u60a8\u7684\u53cd\u9988","70":"\u4ee5\u4e0a\u4e3a\u5386\u53f2\u8bb0\u5f55","71":"\u53d1\u9001\u6210\u529f\uff0c\u8bf7\u7559\u610f\u60a8\u7684\u7535\u8bdd\u8fdb\u884c\u63a5\u542c","72":"\u5f53\u524d\u5ba2\u670d\u6b63\u5728\u901a\u8bdd\u4e2d\uff0c\u8bf7\u7b49\u5f85\u5ba2\u670d\u56de\u62e8","73":"\u8bf7\u8f93\u5165\u6709\u6548\u7684\u624b\u673a\u53f7\u7801!","74":"\u4eba\u5de5\u5ba2\u670d\u63a5\u5165\u4e2d...","75":"\u7531\u4e8e\u5f53\u524d\u4eba\u5de5\u5ba2\u670d\u4e0d\u5728\u7ebf\uff0c\u60a8\u53ef\u4ee5\u9009\u62e9 ","76":"\u56de\u547c\u529f\u80fd\u5df2\u5173\u95ed","77":"\u4e0e\u5ba2\u670d\u53f7\u7801\u76f8\u540c\uff0c\u8bf7\u786e\u8ba4\u540e\u91cd\u8bd5","78":"\u77ed\u65f6\u95f4\u5b58\u5728\u76f8\u540c\u7684\u547c\u53eb\uff0c\u8bf7\u52ff\u91cd\u590d\u53d1\u8d77","79":"\u5f53\u524d\u901a\u8bdd\u7e41\u5fd9\uff0c\u8bf7\u7a0d\u540e\u62e8\u6253","80":"\u5fae\u4fe1\u626b\u7801&nbsp;\u54a8\u8be2\u540c\u6b65","81":"\u63d0\u4ea4\u8868\u5355","82":"\u63d0\u4ea4\u6210\u529f","83":"\u8bf7\u8f93\u5165","84":"\u8bf7\u9009\u62e9","85":"\u63d0\u4ea4\u4e2d...","86":"\u53d1\u9001\u6210\u529f","87":"\u83b7\u53d6\u9a8c\u8bc1\u7801","88":"\u8bf7\u83b7\u53d6\u9a8c\u8bc1\u7801!","89":"\u53d1\u9001","90":"\u624b\u673a\u9a8c\u8bc1\u7801","91":"\u91cd\u65b0\u53d1\u9001","92":"\u5411\u60a8\u7684\u624b\u673a\u53d1\u9001\u4e86\u9a8c\u8bc1\u7801\uff0c\u8bf7\u5728\u4e0b\u65b9\u8f93\u5165\u5e76\u53d1\u9001","93":"\u626b\u7801+\u5fae\u4fe1","94":"\u590d\u5236\u5fae\u4fe1","95":"\u5728\u7ebf\u62e8\u6253","96":"\u8f93\u5165\u624b\u673a\u53f7\u7801","97":"\u70b9\u51fb\u514d\u8d39\u901a\u8bdd","98":"\u52a0 QQ","99":"\u5f53\u524d\u901a\u8bdd\u7e41\u5fd9\uff0c\u8bf7\u7a0d\u540e\u62e8\u6253","100":"\u59d3\u540d","101":"\u624b\u673a\u53f7\u7801","102":"\u5730\u5740","103":"\u90ae\u7bb1","104":"\u5fae\u4fe1","105":"\u53d1\u9001"};//语言包
	// var language = "cn";//语言
	var voteArr = ["\u6076\u52a3  ","\u8f83\u5dee  ","\u4e00\u822c  ","\u8f83\u597d  ","\u6ee1\u610f  "];//评分语言包
	var company_tpl = "minichat";//判断新窗口还是浮框
	var base_host = "53kf.com";
	var master_host = "tb.53kf.com";
	var mtalk_host = "mtalk.53kf.com";//第三方接口host
	var kfs3_host = "kfs3.53kf.com";
	var arg = "";
	var mytempid = "0";//当前窗口id
	var myfirst_tempid = "0";//第一个窗口id
	var tfrom = "2"; //对话开始方式
	var is_group = "0"; // 1:集团挂码
	var is_assist = 0;//是否使用过辅助方式获取访客编号
	var is_get_guest_id = "0";//是否使用浏览器指纹获取访客id
	var finger_host = "fingerprintjs.53kf.com";//浏览器指纹域名
	var is_set_finger = 0;//lnk返回时是否设需要置指纹模式访客编号
	var guest_id_from_get = 10091778952020;
	var use_cust_guestid = 0;

	var talkpage = "http://www.ecfocus.com/website.html";//咨询页面
	var landpage = "http://www.ecfocus.com/website.html";//着陆页面
	var frompage = "http://www.ecfocus.com/cases-c1.html";//来源页面
	var talktitle = getCookie("talktitle_70751269");//咨询页面标题
	var channel = "";//渠道
	var search_engine = "";//搜索引擎
	var keyword = "";//关键词
	var ip = "64.227.18.187";//ip地址
	var guest_ip_info = "新泽西州北伯根[DigitalOcean, LLC]";//ip详情
	var ucust_id = ""; //客户网站会员ID
	var u_stat_id = '';//第三方数据统计ID
	var uid = '042173d2acb9c1eff038ce8557d29d92';
	var finger_id = "";//浏览器指纹
	var comeinfo = {"logo":"","title":"","content":"","curl":"","sendtype":0};//访客来的图文信息
	var custmsg = "";//访客来的图文信息
	
	var conn_prompt = "<p>您好，我们是专业制作网站的公司，请问是要做什么网站呢？（价格具体看您的要求；欢迎免费咨询<span style=\"color:#cc0000;background-color: rgb(255, 255, 255);\"><strong><span style=\"text-decoration:underline;\">137-6029-9067</span></strong></span>）</p>";//公司接通提示语
	var conn_prompt_list = {"10150756":{"carousel_prompt1":"\u60a8\u597d\uff0c\u6211\u4eec\u662f\u4e13\u4e1a\u5236\u4f5c\u7f51\u7ad9\u7684\u516c\u53f8\uff0c\u8bf7\u95ee\u662f\u8981\u505a\u4ec0\u4e48\u7f51\u7ad9\u5462\uff1f\uff08\u4ef7\u683c\u5177\u4f53\u770b\u60a8\u7684\u8981\u6c42\uff1b\u6b22\u8fce\u514d\u8d39\u54a8\u8be2<span style=\"color: rgb(204, 0, 0); background-color: rgb(255, 255, 255);\"><strong><u>0755-83724782\/13760299067<\/u><\/strong><\/span>\uff09&nbsp;","carousel_time1":"15","carousel_prompt2":"<p>\u6b22\u8fce\u60a8\uff01\u6211\u662f\u516c\u53f8\u7684\u5728\u7ebf\u987e\u95ee\uff0c\u5f88\u9ad8\u5174\u4e3a\u60a8\u670d\u52a1\uff01<\/p><p>\u60a8\u4e5f\u53ef\u4ee5\u7559\u4e0b\u8054\u7cfb\u65b9\u5f0f\uff08\u7535\u8bdd\u3001\u5fae\u4fe1\u3001QQ\uff09\uff0c\u6211\u4eec\u5c06\u57282\u5206\u949f\u5185\u548c\u60a8\u8054\u7cfb\u3002<\/p>","carousel_time2":"15","carousel_prompt3":null,"carousel_time3":"15","carousel_prompt4":null,"carousel_time4":"15","carousel_prompt5":null,"carousel_time5":"15","carousel_prompt6":null,"carousel_time6":"15","carousel_prompt7":null,"carousel_time7":"15","carousel_prompt8":null,"carousel_time8":"15","carousel_num":"1","conn_prompt":"","carousel":"1"},"10186226":{"carousel_prompt1":"","carousel_time1":"15","carousel_prompt2":"","carousel_time2":"15","carousel_prompt3":null,"carousel_time3":"15","carousel_prompt4":null,"carousel_time4":"15","carousel_prompt5":null,"carousel_time5":"15","carousel_prompt6":null,"carousel_time6":"15","carousel_prompt7":null,"carousel_time7":"15","carousel_prompt8":null,"carousel_time8":"15","carousel_num":"1","conn_prompt":"","carousel":"1"},"5367190":{"carousel_num":null,"conn_prompt":"\u60a8\u597d\uff0c\u6b22\u8fce\u60a8\u7684\u54a8\u8be2\uff0c\u8bf7\u95ee\u9700\u8981\u505a\u4ec0\u4e48\u6837\u7684\u7f51\u7ad9\u5462\uff1f ","carousel":null},"5367198":{"carousel_num":null,"conn_prompt":"<p>\u60a8\u597d\uff0c\u4e16\u7eaa\u660e\u73e0\u6b22\u8fce\u60a8\uff0c\u8bf7\u95ee\u662f\u8981\u505a\u4ec0\u4e48\u7f51\u7ad9\u5462\uff1f(\u4ef7\u683c\u8303\u56f4800-2500\u7684\u90fd\u6709\uff0c\u5177\u4f53\u770b\u60a8\u7684\u8981\u6c42)\uff08\u60a8\u7684\u4e13\u5c5e\u5ba2\u670d\uff1a13717148905 &nbsp;\u4ed8\u5c0f\u59d0\uff09<\/p>","carousel":null},"5367199":{"carousel_num":null,"conn_prompt":"<p>\u60a8\u597d\uff0c\u9700\u8981\u505a\u4ec0\u4e48\u7f51\u7ad9\u5462\uff1f<\/p>","carousel":null},"5621406":{"carousel_num":null,"conn_prompt":"\u60a8\u597d\uff0c\u6b22\u8fce\u60a8\u7684\u54a8\u8be2\uff0c\u8bf7\u95ee\u6709\u4ec0\u4e48\u9700\u8981\u5e2e\u52a9\u7684\u5417\uff1f ","carousel":null},"5633792":{"carousel_num":null,"conn_prompt":"<div>\u60a8\u597d\uff0c\u6b22\u8fce\u6765\u6211\u4eec\u4e16\u7eaa\u660e\u73e0\uff0c\u8bf7\u95ee\u662f\u8981\u505a\u4ec0\u4e48\u7f51\u7ad9\u5462\uff1f(\u4ef7\u683c\u8303\u56f4800-2500\u7684\u90fd\u6709\uff0c\u5177\u4f53\u770b\u60a8\u7684\u8981\u6c42)\uff08\u6b22\u8fce\u514d\u8d39\u54a8\u8be2\uff0c\u670d\u52a1\u70ed\u7ebf400-637-8090\uff09<br \/><\/div>","carousel":null},"5652061":{"carousel_num":null,"conn_prompt":"<p>\u60a8\u597d\uff01\u6b22\u8fce\u60a8\u7684\u54a8\u8be2\uff0c\u8bf7\u95ee\u6709\u4ec0\u4e48\u9700\u8981\u5e2e\u52a9\u7684\u5417\uff1f<\/p>","carousel":null}};//所有客服个人接通提示语
	var close_prompt = "感谢您的咨询！谢谢，再见！ ";//公司结束提示语
	var close_prompt_list = {"10150756":"","10186226":""};//所有客服个人结束提示语
	var kf_auto_tip = "0"; //公司设置 客服繁忙提示时间
	var kf_auto_tip_phrase = ""; //公司设置 客服繁忙提示语
	var busy_prompt_list = {"10150756":"","10186226":""};//所有客服个人繁忙提示语
	var busy_prompt_time_list = {"10150756":"1800","10186226":"1800"};//所有客服个人繁忙提示语时间
	var imkf_no_talk_time = "600"; // IM客服无响应时间(s)
	var auto_disconnect = "10";//访客无响应自动断开  0:表示关闭  不为0表示断开需等待分钟数(大于3)
	var disconnect_prompt = "";//访客无响应自动断开提示语
	var reject_prompt = "抱歉，暂时无法连接客服";//黑名单阻止提示语

	var prompt_guide_list = [{"title":"\u5176\u4ed6","id":"0","prompt":[]}];//智能引导
	var guidance_type = "1";//智能引导类型 1:发送消息建立对话 2:键入时建立对话
	var prompt_cookie = getCookie("prompt_guide_70751269");
	var prompt_guide_size = 0;//智能引导已发送条数
	var wait_host = "wait.53kf.com";//智能引导域名
	var robot_prompt_guide = [];//机器人智能引导

	var scene_guide_list = {"1":{"option_id":"1","option_cont":[{"type":"message","cont":"\u6b22\u8fce\u4f60\u7684\u54a8\u8be2"}],"action":"","option_btn":[]}};//场景引导
	var scene_cookie = getCookie("scene_guide_70751269");
	var scene_guide_step = "";//场景引导已经发送过的步骤
	var scene_step_arr = scene_guide_step.split(',');
	var scene_host = "jhscene.53kf.com";//场景引导域名
	var formSendClick = false;//是否点击了场景引导提交

	var robotassign = "0";//接待优先 0:客服优先  1:机器人优先 2:智能引导 3:场景引导
	var frobotassign = "0";//离线接待优先 0:留言 1:机器人优先 2:场景引导
	var zdkf_auto = "15";//手动选择模式自动连接 off:关闭 数字:连接秒数
	var worker_ids = "anna@ecfocus.com,13590308967@qq.com";//参与接待的工号
	var hasOnlineKf = "1";//是否有参与接待的工号在线
	var zdkf_type = '1';//指定方式 1：人员 3:分组
	var kflist = "off";//是否展示客服列表 on/off
	var kf_status = '1';//显示客服繁忙程度
	var kf_expand = "1";//默认展开分组
	var kf_show = "1";//显示离线客服
	var dept_man_show = "1";//显示客服分组
	var lnk_overflow = "0";//发送lnk用，0:正常  1:走溢出，java不用判断排班  2:没有客服接待，直接进留言 3:抢接机器人对话，不走排班，小休也进
	var receptionList = [];//手动选择 接待列表

	var reg = "0";//咨询前注册
	var is_reg = "0";//是否已经注册过
	var reg_prompt = "";//注册提示语
	var fkzc_fields = [];//注册选项

	var ly_first = true; // 首次留言
	var ly_captcha = '2';//留言验证码是否开启
	var lword_prompt = "您好，现在客服不在线，请留言。";//留言提示语
	var m_lwordObject = ''; // 留言对象
	var ly_assign_type = '1';//分配方式   0：手动分配   1：自动分配
	var ly_assign_obj = 'zdgs';//指定方式  zbkf：值班客服  zdgs：指定公司  zdfz：指定分组  zdkf：指定客服
	var ly_assign_value = '';//指定对象
	var fkly_fields = [{"name":"\u59d3\u540d","isMust":"1","field_name":"name","order":"0","isZdy":"0"},{"name":"\u624b\u673a","isMust":"1","field_name":"mobile","order":"1","isZdy":"0"}];//表单留言选项
	var lwordObjectInfo = {"objectType":"auto","object":""};//留言对象
	var lyClick = false;//是否点击提交留言
	var close_ly_window_timer = 0;//留言成功自动关闭窗口定时器

	var robotList = {"3b8d520fe413d61f5220e3c7e064c94c":{"api_robot_id":"","api_name":"","name":"\u5c0f\u82b8","prompt":"\u6b22\u8fce\u60a8\u7684\u54a8\u8be2\uff0c\u5f88\u9ad8\u5174\u4e3a\u60a8\u670d\u52a1","un_prompt":"\u5f88\u62b1\u6b49\uff0c\u65e0\u6cd5\u56de\u7b54\u60a8\u7684\u95ee\u9898\u3002 \u60a8\u53ef\u4ee5\u9009\u62e9\u8f6c\u4eba\u5de5\u6216\u7ed9\u6211\u4eec\u7559\u8a00","zsktb_url":"\/style\/setting\/ver07\/img\/task_robot_logo.png","id":"3b8d520fe413d61f5220e3c7e064c94c","feedback":"1","lwswitch":"0","zdzrg":"0","unret_times":"2","admit_rule":"0","kw_trans":[{"key_word":"\u6d4b\u8bd5123","match_type":"0"}],"task_robot_use":0,"vars":[],"hots":[],"robot_time":{"switch":0,"robot_timeout_data":[],"isopen":0}}};//所有机器人
	var robot_id = "";// 在线机器人id
	var frobot_id = "";// 离线机器人id
	var robot_host = "robot.53kf.com";//机器人对话服务域名
	var talk_robot_info = [];//机器人对话信息
	var task_robot_info = [];//任务机器人信息
	var task_type = "match_first";//任务库match_first正则匹配优先，keyword_first关键词匹配优先
	var taskHotsInfo = [];//机器人热点问题

	var fire_set = "0";//是否开启防火墙
	var fire_level = "1";//防火墙等级
	var lnk_fire = "4058e2390c39bbed4750095bc62ef2b1fd2668a77b6920031b27774fdbde23ee"; // 防火墙lnk校验参数
	var firewall_uuid = "1ff3425c3c5811dac9db6f772168ac67";// 访客防火墙 uuid 作为页面识别
	var verify_code = "0";//是否开启点触式验证码
	var is_verify = "0";//是否需要验证
	var verify_key = "e0fbc21132c39c56f31f91bd1c3a4204";//comet验证用
	var lnk_param = "%60%F6%22-"; // lnk参数
	var saverec_code = "4c179bdd0941563e6e24139104e7e6203e340dac6e89491832d8388b17cc46bf";//聊天记录下载验证码
	var commond_version = "123456"; //webClient.js的版本号，上发到服务端
	var lnkopentime = "1626743341";//访客端程序加载时间
	var open_time = new Date().getTime();//窗口打开时间

	var cname = "深圳市世纪明珠";//公司名称
	var company_logo = "https://www10c1.53kf.com/img/upload/9007605/mobile/temp/mobile_53kf_1553477410.jpg";//公司logo
	var kf_header = "style/chat/new2017/image/png/company-logo-default.png";//默认头像
	if (company_logo != '') kf_header = company_logo;
	var adminHeaderUrl = ""; //主账号头像
	var admin_bname = "世纪明珠";//主账号昵称
	var adminId6d = "5367190";//主账号id6d
	var kefuCodeList = [];//所有客服微信二维码
	var visitorPathSwitchList = {"10186226":"0"};//所有客服的  访客操作和行为轨迹 开关
	var visitorPathSwitch = '1';//默认开启
	var admin_wx_code = '';//当前客服的微信二维码
	var fk_music = "";//访客端音效
	var color_kfqp = "rgb(239, 243, 246)";//客服气泡颜色
	var color_fkqp = "rgb(31, 140, 232)";//访客气泡颜色
	var color_fkxx = "rgb(255, 255, 255)";//访客消息颜色
	var color_kfxx = "rgb(58, 60, 76)";//客服消息颜色
	var color_fsan = "rgb(30, 137, 230)";//发送按钮颜色
	var fk_history = "0";//显示上次聊天记录
	var kfpf = "0";//评分开关
	var evaluate_way = "0";//评价方式
	var default_star = "5";//默认星值
	var three_star_guide = "留下您的宝贵意见，我们将为此提升服务质量";//3星评价引导语
	var two_star_guide = "发生了什么不开心的事？请反馈给我们";//2星评价引导语
	var one_star_guide = "发生了什么不开心的事？请反馈给我们";//1星评价引导语
	var evaluate_ask = "0";//评价填写要求
	var vote_true = false;//是否评过分
	var kf_card = "1";//是否展示客服名片
	var net_callBack = "0";//网络回拨功能是否开启
	var callBackClick = false;//是否点了击网络回呼
	var callback_phone = '';//客服网络回拨电话
	var wx_public_account = "0";//是否公总号授权  0,1
	var wx_drainage = "1";//是否开启微信访客端引流   0,1
	var qrcode_url = '';//公众号二维码图片
	var check_phone = "0";//对话中手机号码验证 开关
	var checkPhoneArr = new Array();
	var visitor_form = [];//自定义表单
	var pc_inertact_menu = [];//互动菜单
	var pcMenuHideTimes = "0";//自动隐藏互动菜单点击次数
	var inertactMenuAnswerTime = 1500;//互动菜单快问快答的回答时间间隔(毫秒)
	var mini_size = "1";//浮框尺寸
	var btn_switch = ["wechat","qq","phone"];//信息识别开关  微信 qq 电话
	var last_talk_id = 0;
	var conn_prompt_num = 0;
	var browserType = getBrowserType();
	var pcOs = getPcOs();
	var sensitiveWords = [];//敏感词
	var mobile_finger_log = "0";//浏览器指纹日志
	var talk_finger_log = "0";//对话浏览器指纹检测
	var encrypt_code = "03tpisygids8dp857feqbgvt";//访客消息中手机号加密规则
}catch(e){console.log(e)}

initial();

function changeModule(type){
	switch(type){
		case 'showkflist':
			$(".talk .line-up").hide();
			$(".maskArea").hide();
			$(".select-customer").show().siblings().hide();
			break;
		case 'talk':
			$(".connectionFail").hide();
			$(".talk").show().siblings().hide();
			$('.pc_talk_content').show();
			$(".talk .line-up").hide();
			try{
				$('.edui-upload-video').eq(0).trigger('play');
			}catch(e){}
			$(".robot-function-bar").hide().siblings(".talk-function-bar").show();
			$(".system-wait").remove();
			$(".maskArea").hide();
			hideRobotTips();
			break;
		case 'reg':
			showRegHtml();
			$(".before-talk").show().siblings().hide();
			break;
		case 'scene':
			$(".talk").show().siblings().hide();
			$(".talk").addClass('hasScene');
			$('.pc_talk_content').show();
			$(".pc-visitor-footer").hide();
			break;
		case 'lword':
			$(".talk .line-up").hide();
			$(".maskArea").hide();
			showLwordHtml();
			$(".leave-message").show().siblings().hide();
			break;
		case 'stop':
			$(".talk").show().siblings().hide();
			$(".beStopped").show();
			display_sys_msg("access block!");
			break;
		case 'robot':
			changeModule('talk');
			$(".window-content").removeClass('on-talking');
			$(".pc-visitor-footer").show();
			$(".talk-function-bar").hide().siblings(".robot-function-bar").show();
			$("#robot_start_time").text(getTime2());
			showRobotHtml();
			if (zsk_admit_rule != '0') $(".robotToKF").hide();
			if (zsk_api_robot_id != "" || task_robot_use == '1' || zsk_lwswitch == '1') $(".robotToLword").hide();
			break;
		case 'busy':
			changeModule('talk');
			$("#file-picker").on("click",".webuploader-element-invisible",function(){
				return false;
			})
			if(robot_id != ''){
				$(".toRobot").show();
			}
			$(".personNum").html(m_busyCnt);
			$(".talk .line-up").show();
			if(browserType == 'IE'){
				$(".changeColor-wrap").siblings(".function-icon-disabled").css({"opacity":0.5,"filter":"alpha(opacity = 50)","cursor":"not-allowed"});
				$(".changeColor-wrap").siblings(".function-icon-disabled").not(".upload_box").addClass("disabled");
			}else{
				$(".changeColor-wrap").siblings(".function-icon-disabled").addClass("disabled");
			}
			break;
		case 'black':
			changeModule('talk');
			$(".beStopped").show();
			break;
		case 'lnksuccess':
			changeModule('talk');
			$(".changeColor-wrap").siblings(".function-icon-disabled").removeClass("disabled");
			$(".upload_box").hover(function(){
				$(".upload_copy .svgColor").css("fill","#1F8CEB")
			},function(){
				$(".upload_copy .svgColor").css("fill","#466080")
			})
			showVoteIcon();
			$(".talk").removeClass('hasScene');
			$(".pc-visitor-footer").show();
			if (net_callBack == 1) {
				$(".talk").addClass("hasCallBack");
			}
			var msg_div = "<div id='talk_pos' style='display: none'></div>";
			$('.pc_talk_content').append(msg_div);
			break;
		case 'talkend':
			try{
				$(".pc_ptlink_notice").each(function(){
					$(this).remove();
				});
			}catch (e){}
			$(".maskArea").show();
			try{
				$('.talk .edui-upload-video').trigger('pause');
			}catch(e){}
			kindeditor.html("");
			try{
				menu.menuhide();
			}catch(e){}
			break;
	}
}

//手动选择模式 展示客服列表
function showKfList(){
	changeModule('showkflist');
	var zdkf_prompt = UBBCode(UBBEncode(""));
	var html = "<h6 class='font13 color-grey-deep'>"+zdkf_prompt+"</h6><div class='groups'>";
	if (zdkf_type == '1') {
		if (dept_man_show == '1') {// 指定人员+显示分组
			var kflistHtml = getKflistHtml('group_kf',receptionList);
		}else{
			var kflistHtml = getKflistHtml('kf',receptionList);
		}
	}else if (zdkf_type == '3'){
		var kflistHtml = getKflistHtml('group',receptionList);
	}
	html += kflistHtml;
	if (robot_id != '') {
		var robotHtml = getKflistHtml('robot',robotList[robot_id].name);
		html += robotHtml;
	}
	html += "</div>";
	$(".select-customer").html(html);
}

//组装客服列表html
function getKflistHtml(type,infos){
	var html = '';
	if (type == 'kf') {
		if (dept_man_show != '1') {
			if (kf_expand == 1) {// 20 全部客服
				html += "<p class='slide-down'>"+langs[20]+"</p><div class='customer-lists'>";
			}else{
				html += "<p>"+langs[20]+"</p><div style='display:none;' class='customer-lists'>";
			}
		}
		for (var i=0;i<infos.length;i++){
			var worker_id = infos[i].worker_id;
			var nowlink = infos[i].nowlink;
			var maxlink = infos[i].max_link;
			var bname = infos[i].bname;
			var is_online = infos[i].state;
			var kf_state = '';
			if (is_online == '1') {
				kf_state = kfState(maxlink, nowlink);
				html += "<p onclick='to_kf(\""+worker_id+"\",1)'><a class='font12 color-blue'>"+bname+kf_state+"</a></p>";
			}else{
				if (kf_show == '1') {
					html += "<p onclick='to_kf(\""+worker_id+"\",0)'><a class='font12 color-grey-light'>"+bname+"</a><font class='color-blue'>("+langs[19]+")</font></p>";
				}
			}
		}
		html += "</div>";
	}else if (type == 'group') {
		html += "<p class='slide-down'>"+langs[26]+"</p><div class='customer-lists'>";//全部分组
		for (var i=0;i<infos.length;i++){
			var group_name = infos[i].group_name;
			var worker_ids = infos[i].worker_ids;
			var worker_num = "(<span style='color:gray'>"+langs[22]+"</span>)";//离线
			var is_online = 0;
			if (infos[i].online_num > 0) {
				// worker_num = infos[i].online_num+langs[24];//位客服在线
				worker_num = '';//位客服在线
				is_online = 1;
			}
			html += "<p onclick='to_kf(\""+worker_ids+"\","+is_online+")'><a class='font12 color-blue'>"+group_name+"</a> "+worker_num+"</p>";
		}
		html += "</div>";
	}else if (type == 'group_kf') {
		for (var i=0;i<infos.length;i++) {
			if (infos[i].online_num == 0 && kf_show != '1') continue;
			var group_name = infos[i].group_name;
			if (group_name == '') group_name = langs[64];//未分组
			if (kf_expand == 1) {
				html += "<p class='slide-down'>"+group_name+"</p><div class='customer-lists'>";
			}else{
				html += "<p>"+group_name+"</p><div style='display:none;' class='customer-lists'>";
			}
			var kf_html = getKflistHtml('kf',infos[i].workers,true);
			html += kf_html;
		}
	}else if (type == 'robot') {
		html += "<p class='slide-down'>"+langs[27]+"</p>";//智能机器人（自助答疑）
		html += "<div class='customer-lists'><a class='font12 color-blue' onclick='showzsk()'>"+infos+"</a></div>";
	}
	return html;
}

// 客服状态
function kfState(max_link, cnt){
	var state = "";
	if(max_link!=cnt){
		if (kf_status == '1') {
			if (cnt >= Math.ceil(max_link/2)) {
				state = '<font color="#FF0000">('+langs[33]+')</font>';//繁忙
			}
		}
	}else{
		state = '<font color="#FF0000">('+langs[32]+')</font>';//排队
	}
	return state;
}

function showRegHtml(){
	var reg_html = '<div class="message-h font13 color-grey-deep">'+UBBCode(UBBEncode(reg_prompt))+'</div>';
	for(var key=0;key<fkzc_fields.length;key++){
		if (fkzc_fields[key].isMust == 1) {
			reg_html += '<p class="message-name font12 color-grey-deep"><label class="color-red">*</label>'+fkzc_fields[key].name+'<a>'+langs[0]+fkzc_fields[key].name+'</a></p><input id="reg_'+fkzc_fields[key].field_name+'" type="text" class="must"/>';
		}else{
			reg_html += '<p class="message-name font12 color-grey-deep">'+fkzc_fields[key].name+'<a>'+langs[0]+fkzc_fields[key].name+'</a></p><input id="reg_'+fkzc_fields[key].field_name+'" type="text"/>';
		};
	}
	reg_html += '<a class="message-btn prevent-send" id="to_link" onclick="sendReg(this)" style="background-color:'+color_fsan+';">'+langs[4]+'</a>';//发送并咨询
	$(".before-talk").html(reg_html);
}

function showRobotHtml(){
	var hot_str = '';
	if (zsk_hots.length > 0) {
		var q_list = '';
		for (var i = 0; i < zsk_hots.length; i++) {
			var order = i + 1;
			// 单引号兼容
			var init_question = zsk_hots[i].question.replace(/'/g,"\\'");
			q_list += '<li onmouseup="this.style.color=\'#62778C\'" onclick="dealRobotQa(\''+zsk_hots[i].id+'\',\''+init_question+'\',\''+zsk_hots[i].answer+'\',\'hot\')">'+order+'.'+zsk_hots[i].question+'</li>';
		}
		hot_str += '<div class="question-lists" ><p>以下是您关心的问题吗：</p>'+
						'<ul class="questions">'+
							q_list+
						'</ul>'+
					'</div>';
	}
	var zsk_conn_prompt = UBBCode(UBBEncode(zsk_prompt));
	var msg_btns=auto_msg_handle(zsk_conn_prompt);
	var html_str = '<div class="pc-service" id="robot_start">'+
						'<div class="pc-service-left" style="display: inline-block;"><img src="'+zsk_zsktb_url+'" alt="头像"></div>'+
						'<div class="pc-service-right">'+
							'<p><label>'+zsk_name+'</label><span id="robot_start_time"></span></p>'+
							'<div class="pc-service-info pc-robot-info">'+
								'<h6 class="pc-robot-reply">'+zsk_conn_prompt+'</h6>'+
								hot_str+
							'</div>'+msg_btns+
						'</div>'+
					'</div>';
	display_talk_msg(html_str);
}

function showLwordHtml(){
	var fkly_html = '<div class="message-h font13 color-grey-deep">'+UBBCode(UBBEncode(lword_prompt))+'</div>';
	for(var key=0;key<fkly_fields.length;key++){
		if (fkly_fields[key].isMust == 1) {
			fkly_html += '<p class="message-name font12 color-grey-deep"><label class="color-red">*</label>'+fkly_fields[key].name+'<a>'+langs[0]+fkly_fields[key].name+'</a></p><input id="ly_'+fkly_fields[key].field_name+'" type="text" class="must"/>';
		}else{
			fkly_html += '<p class="message-name font12 color-grey-deep">'+fkly_fields[key].name+'<a>'+langs[0]+fkly_fields[key].name+'</a></p><input id="ly_'+fkly_fields[key].field_name+'" type="text"/>';
		};
	}
	if (lwordObjectInfo['objectType'] == 'auto') {
		m_lwordObject = lwordObjectInfo['object'];
	}else{
		var is_appoint_group = '';
		var object_html = '';
		var objectName = langs[29];
		var objectArr = lwordObjectInfo['object'];
		if (lwordObjectInfo['objectType'] == 'zdkf') {
			var is_first_kf = true;
			for(var group_id in objectArr){
				var group_name = objectArr[group_id]['group_name'];
				var workers = objectArr[group_id]['workers'];
				var worker_str = '<ul data-text="'+group_name+'" class="person-lists slide-tpl" style="display: none;">';
				for(var id6d in workers){
					var bname = workers[id6d];
					if (bname == '' || bname == null) bname = langs[45];
					if (is_first_kf) {
						is_first_kf = false;
						m_lwordObject = 'w#' + id6d;
						objectName = group_name+'/'+bname;
					}
					worker_str += '<li class="person-list" onclick="set_ly_obj(this)" data-val="w#'+id6d+'" title="'+bname+'">'+bname+'</li>';
				}
				worker_str += '</ul>';
				object_html += '<li class="lword-object-list" data-val="0">'+group_name+worker_str+'</li>';
			}
		}else{
			is_appoint_group = 'is_appoint_group';
			var is_first_group = true;
			for(var group_id in objectArr){
				if (is_first_group) {
					is_first_group = false;
					m_lwordObject = 'g#' + group_id;
					objectName = objectArr[group_id];
				}
				object_html += '<li onclick="set_ly_obj(this)" data-val="g#'+group_id+'">'+objectArr[group_id]+'</li>';
			}
		}
		fkly_html += '<div class="leaveObj-wrap field-wrap" style="display:block;font-size:12px;">'+
						'<p class="message-name isInfo-msg"><label class="color-red">*</label><span>'+langs[28]+'</span></p>'+
						'<div class="lword-object-wrap '+is_appoint_group+'">'+
							'<p class="lword-object color-grey-light">'+objectName+'</p>'+
							'<ul class="lword-object-lists" style="display: none;">'+object_html+'</ul>'+
						'</div>'+
					'</div>';
	}
	fkly_html += '<p class="message-name font12 color-grey-deep">'+langs[2]+'</p>';
	fkly_html += '<textarea id="ly_content"></textarea>';
	fkly_html += '<a class="message-btn" id="submit_lword" onclick="submit_lword()" style="background-color:'+color_fsan+';">'+langs[6]+'</a>';

	try{//定制留言界面 预留方法
		fkly_html = get_ly_html(fkly_html);
	}catch(e){}
	$(".leave-message").html(fkly_html);
	// if (is_reg == '1') getUserCard();
}

//设置留言对象
function set_ly_obj(obj){
	m_lwordObject = $(obj).attr("data-val");
}


// 设置留言项的值
function setLyItemsValue(userCard){
	for(var key=0;key<fkly_fields.length;key++){
		var field = fkly_fields[key].field_name;
		if (userCard[field] == undefined || userCard[field] == '' || userCard[field] == null) continue;
		try{document.getElementById("ly_"+field).value = userCard[field];}catch(e){}
		if (field == 'name') {
			$("#ly_name").prev().hide();
			$("#ly_name").hide();
		}
	}
}


//留言关闭窗口
function close_ly_window(){
	if (company_tpl == 'minichat') {
		window.location.reload(true);
		try{
			top.postMessage('53kf_min_window', '*');//强制对话框最小化
		}catch(e){}
	}else{
		basic.close_window();
	}
	try{
		if (close_ly_window_timer) {
			clearInterval(close_ly_window_timer);
		}
	}catch(e){}
}

// 发送访客消息，点发送按钮
function sendmsg(msg) {
	var is_empty = false;
	if (msg == undefined) {
		msg = $.trim(kindeditor.html());
		var blank = /<br \/>$/;
		if(blank.exec(msg)){
			msg = msg.replace(blank,'');
		}
		if (kindeditor.text().replace(/&nbsp;/g,'').replace(/ /g,'') == '') is_empty = true;
		kindeditor.html("");
	}else{
		if (msg.replace(/&nbsp;/g,'').replace(/ /g,'') == '') is_empty = true;
	}

	if(is_empty){
		basic.toastOut(langs[50]);//发送内容不能为空，请重新输入。
		return false;
	}
	if (pcMenuHideTimes != '0') {
		menu.menuhide();
	}
	var kw_trans_msg = msg;//机器人关键词转人工用
	if(guidance_type == 1) zn_order();//智能引导

	//处理base64粘贴截图
	var reg = new RegExp("<img src=\"data:image/[^>]*;base64[^>]*\" />", "gi");
	if (reg.test(msg)) {
		msg = msg.replace(reg,function(img){
			var base64_src = img.replace(/<img[^>]*src=[\'\"\s]*([^\s\'\"]+)[^>]*>/ig,'$1');
			var img_str = '';
			$.ajax({
				type: "POST",
				url: http_pro+host+'/upload_img_file.php?company_id='+company_id,
				data: "type=base64&base64_src="+encodeURIComponent(base64_src),
				dataType: "json",
				async : false,
				success: function(result){
					if (result.upload == 'success') {
						img_str = '<img src="'+result.url+'" border="0"/>';
					}
				}
			});
			return img_str;
		});
	}
	try{
		msg = msgFilter(msg);
	}catch(e){}
	//过滤超链接
	if (isJsLink(msg)) return false;
	// 过滤敏感词
	msg = filterSensitiveWords(msg);
	
	var show_msg = msg;
	show_msg = UBBEncode(show_msg);
	var reg = new RegExp("(\\[MOBILE\])(\\d+?)(\\[\\/MOBILE\\])","gim");
	var has_mobile = 0;
	if (reg.test(show_msg) == true) {
		has_mobile = 1;
	}
	show_msg = UBBCode(show_msg);
	msg = UBBEncode(msg);
	msg = $.trim(msg);
	if(lnkover != 1){
		if (lnkover==4) {// 更改成机器人咨询
			if (zsk_admit_rule == '1') $(".robotToKF").show();
			if (zsk_kw_trans.length > 0 && task_robot_use == '0') {
				for (var i = 0; i < zsk_kw_trans.length; i++) {
					if (zsk_kw_trans[i].match_type == '0') {
						if (kw_trans_msg == zsk_kw_trans[i].key_word) {
							display_fk_msg(show_msg);
							offToTalk('robot');
							return;
						}
					}else{
						if (kw_trans_msg.indexOf(zsk_kw_trans[i].key_word) != -1) {
							display_fk_msg(show_msg);
							offToTalk('robot');
							return;
						}
					}
				}
			}
			getRobotReply(show_msg);
		}else if(lnkover==0 || lnkover==5 || lnkover==6){
			display_fk_msg(show_msg);
			var waitMsg = {
				'msg':msg,
				'msg_type':'g',
				'fk_msgid':undefined,
				'msgid':undefined
			};
			msg_wait_arr.push(waitMsg);
			if (lnkover==5) {
				var show_msg_busy = langs[12]+'<a style="cursor:pointer;" class="color-blue" onclick="showLword()">'+langs[10]+'</a>';
				if (robot_id != '') {
					show_msg_busy = langs[12]+'<a style="cursor:pointer;" class="color-blue" onclick="showzsk(\''+robot_id+'\')">'+langs[13]+'</a>'+langs[9]+'<a class="color-blue" style="cursor:pointer;" onclick="showLword()">'+langs[10]+'</a>';
				}
				display_sys_msg(show_msg_busy);
			}
		}else{
			basic.toastOut(langs[51]);//对话已结束，不能发送消息。
		}
		return;
	}else{
		if(msg==""){
			basic.toastOut(langs[50]);//发送内容不能为空，请重新输入。
			return;
		}
		var fk_msgid = 'msgid_'+ new Date().getTime();
		var send_qst = true;

		if (check_phone == 1) {
			send_qst = checkPhoneOnTalk(msg);
			if (!send_qst) fk_msgid = undefined;
		}
		display_fk_msg(show_msg,fk_msgid);
		if (send_qst) qstmsg(UrlEncode(msg),fk_msgid);
		try{
			clearTimeout(carousel_id);
		}catch(e){}
	}
}


//msg_type: q(快问快答 访客问题) a(快问快答 客服答案) k(快速提问 无答案) z(访客表单)
function sendQaMsg(msg,msg_type,fk_msgid){
	try{
		msg = msgFilter(msg);
	}catch(e){}
	//过滤超链接
	if (isJsLink(msg)) return false;
	if (msg == '') return;
	var msgid = undefined;
	if (msg_type == 'k') fk_msgid = "msgid_" + new Date().getTime();
	if (msg_type == 'z') msgid = fk_msgid.replace('formid_','');
	var show_msg = UBBCode(UBBEncode(msg));
	if (msg_type == 'q' || msg_type == 'k') {
		if (lnkover == 4 && msg_type == 'k') {
			sendmsg(msg);
		}else{
			display_fk_msg(show_msg,fk_msgid);
		}
	}else if (msg_type == 'a') {
		if (lnkover == 4) {
			display_robot_answer('0',show_msg,'');
		}else{
			display_kf_msg(show_msg);
		}
	}
	if (lnkover == 1) {
		qstmsg(UrlEncode(UBBEncode(msg)),fk_msgid,msg_type,msgid);
	}else if(lnkover == 4){
		if (msg_type != 'k') {
			qstRobotMsg(UrlEncode(UBBEncode(msg)),msg_type);
		}
	}else{
		var waitMsg = {
			'msg':UBBEncode(msg),
			'msg_type':msg_type,
			'fk_msgid':fk_msgid,
			'msgid':msgid
		};
		msg_wait_arr.push(waitMsg);
		zn_order();
	}

	if ((msg_type == 'q' || msg_type == 'k') && pcMenuHideTimes != '0') {
		menu.menuhide();
	}
	
	if (msg_type == 'z') {
		setTimeout(function(){
			changeFormStatus(fk_msgid,false);
		},20000);
	}

	try{
		clearTimeout(carousel_id);
	}catch(e){}

	if (msg_type == 'q' || msg_type == 'k') {
		sendKafkaNew('guest_click_event','qamsg','',msg);
	}
}

//插入图片对象操作
var to_insert_img_obj = {
	sendimg : function(urlstr){
		if(urlstr==""||urlstr=="请输入网络地址或点击浏览上传"){
			basic.toastOut('图片路径不能为空');
			return false;
		}
		var urlcode='[IMG]'+urlstr+'[/IMG]';
		to_insert_img_obj.sendimgmsg(urlcode);
		return true;
	},
	ajaxuploadimg:function(){
		$.ajaxFileUpload({
			url:'upload_img.php?type=visiter&company_id='+company_id,//处理图片脚本
			secureuri :false,
			fileElementId :'img_pic',//file控件id
			dataType : 'json',
			success : function(data, status){
				if(data.upload=='success'){
					$("#src-input").val(data.url);
				}else if(data.upload=='fail'){
					basic.toastOut("上传失败");//上传失败
				}
				if(data.filetype=='error'){
					basic.toastOut("暂不支持该格式!");//暂不支持该格式!
				}
				if(data.maxsize=='true'){
					basic.toastOut("上传文件/图片不能超过100M");//上传文件/图片不能超过100M
				}
			},
			error: function(data, status, e){
				alert(e);
			}
		});
	},
	sendimgmsg:function(msg){
		if (lnkover==1 || lnkover==4 || lnkover==6 || lnkover==0) {
			sendmsg(msg);
		}
	}
};

//图片上传返回
function imgUploadResponse(file,response,wh){
	if (wh == undefined) wh = '';
	var msg = '[IMG]'+response.url+wh+'[/IMG]';
	try{
		msg = msgFilter(msg);
	}catch(e){}
	var show_msg = msg;
	msg = UBBEncode(msg);
	msg = HtmlEncode(msg);
	msg = $.trim(msg);
	$("#"+file.id).data({url:response.url});
	qstmsg(UrlEncode(msg),file.id);
}

function fileUploadResponse(file,response){
	var file_url = "http://"+host+"/down_file.php?type=srv&company_id="+company_id+"&file="+response.real_name;
	file_url = UrlEncode(file_url);
	send_FIL(file_url,'cfile',file.size); // 发送文件给客服
	$("#"+file.id).find(".uploadStatus").text(langs[14]).css("color","#1E88E5");//上传成功
	try{
		clearTimeout(carousel_id);
	}catch(e){}
}

// 展示线索追问按钮
function showTaskOption(options){
	var option_content = "";
	$.each(options,function(i,v){
		var btn_str = "";
		btn_str = '<div class="form_option_btn white_btn" onclick="clickTaskOption(\''+v.link_id+'\',this)">'+v.name+'</div>'
		option_content += btn_str;
	});

	$(".pc_talk_content").append("<div class='form_btn_box'>"+option_content+"</div>");
	basic.scrollPage();
}

//显示机器人问题提示
function showRobotTips(infos){
	var tips = infos.rows;
	var q_list = "";
	for (var i = 0; i < infos.total; i++) {
		var question = tips[i]["question"];
		var answer = tips[i]["answer"];
		var q_id = tips[i]["q_id"];
		if (zsk_api_name == 'yw') {
			q_list = q_list + "<p onclick=\"getRobotReply('" + question.replace(/'/g,"\\&#039;") + "')\" title='"+question.replace(/'/g,"&#039;")+"'>" + question + "</p>";
		}else{
			q_list = q_list + "<p onclick=\"dealRobotQa('" + q_id + "', '" + question.replace(/'/g,"\\&#039;") + "', '" + answer.replace(/&#039;/g,"\\&#039;") + "')\" title='"+question.replace(/'/g,"&#039;")+"'>" + question + "</p>";
		}
	}
	if (q_list != ""){
		$(".guanlian-problem").html(q_list).show();
	} else {
		hideRobotTips();
	}
}

//隐藏机器人问题提示
function hideRobotTips(){
	$(".guanlian-problem").html('');
	$(".guanlian-problem").hide();
}

//展示机器人消息加载框
function showRobotLoad(){
	removeRobotLoad();
	var show_msg = '<div class="loading_box" id="loading_box"><div class="message_loading"></div></div>';
	display_talk_msg(show_msg);
}

//移除机器人消息加载框
function removeRobotLoad(){
	$("#loading_box").remove();
}

//显示自动连接时间提示
function showAutoLink(auto_time){
	$(".connectionFail").show();
	var html = '<label>'+langs[30]+'</label><span>'+auto_time+'</span><label>'+langs[56]+'</label>';//秒后自动为您分配客服接待...
	$(".connectionFail").html(html);
}

//隐藏自动连接
function hiddenAutoLink(){
	$(".connectionFail").hide();
	try{
		clearInterval(m_autoTimer);
	}catch(e){}
}

// 场景引导手机验证
var time_flag = false;
function formVerCode(obj){
	var phonereg =new RegExp(/^[1][3|4|5|6|7|8|9][0-9]{9}$/);
	var phoneval = $(obj).prev().val();
	if(phoneval == "" || !phonereg.test(phoneval)){
		$(obj).prev().addClass('error_import');
		return false;
	}
	var ver_code_str = '<div class="from_box vercode"><input class="from_input input_vercode" type="text" placeholder="'+langs[90]+'"></div>';//手机验证码

	if($(obj).parents(".guide_form").find(".vercode").length < 1 ){
		time_flag = false;
		$(obj).html("60 S")
		$(obj).parents(".form_phone").after(ver_code_str);
	}
	if(!time_flag){
		time_flag = true;
		sendSceneFormCode(phoneval);
		timeGo(obj,60,function(){
			$(obj).html(langs[91]);//重新发送
			time_flag = false;
		});
	}
}

// 倒计时
function timeGo(obj,count,fn) {
	if(!count) count = 60;
	var timout = setInterval(function(){
		count--;
		$(obj).html(count+" S");
		if(count == 0){
			clearInterval(timout)
			fn();
		}
	},1000);
}

//显示转人工无客服在线提示
function showNoKfToTalk(type){
	if (type == 'robot') {
		$(".system-wait").remove();
		display_sys_msg('','no_kf');
	}else if (type == 'scene') {
		$(".system-wait").remove();
		//由于当前人工客服不在线，你可以选择 机器人咨询 或 给我们留言
		if (frobot_id != '') {
			msg = '<p class="system-remind"><label>'+langs[75]+'<a class="color-blue" style="cursor:pointer;" onclick="showzsk(\''+frobot_id+'\');">'+langs[13]+'</a>'+langs[9]+'<a class="color-blue" style="cursor:pointer;"onclick="showLword()">'+langs[10]+'</a></label></p>';
		}else{
			msg = '<p class="system-remind"><label>'+langs[75]+'<a class="color-blue" style="cursor:pointer;"onclick="showLword()">'+langs[10]+'</a></label></p>';
		}
		display_talk_msg(msg);
	}
}

// 评分
function showVote(){
	if(kfpf=='0' || vote_true || obj_id==0) return;
	$(".evaluation").remove();
	// 2021.01.26 初始星数为3的情况
	var ismust = evaluate_ask == 0 ? "（选填）" : "（必填）";

	var new_div = '<div class="evaluation"><div><p>'+langs[15]+'<label>'+langs[16]+'</label></p><ul><li class="li-active"></li><li class="li-active"></li><li class="li-active"></li><li class="li-active"></li><li class="li-active"></li></ul></div><div class="ly_content_box"><textarea name="" id="" maxlength="200" placeholder="'+ismust+three_star_guide+'"></textarea></div><a class="evaluation-btn">'+langs[17]+'</a></div>';
	display_talk_msg(new_div);

	// 2021.01.26 初始星数为3的情况
	if(default_star == 3){
	    $(".evaluation>div>p>label").html(voteArr[2]);
	    $(".evaluation .li-active").eq(4).removeClass('li-active');
	    $(".evaluation .li-active").eq(3).removeClass('li-active');
	}
	if(evaluate_way == 1 && default_star == 3){
	    $(".ly_content_box").show();
	}
}

//显示评分按钮
function showVoteIcon(){
	$(".svgWrap .function-icon-eval").parent().removeClass("disabled");
}

//半隐藏评分按钮
function hiddenVoteIcon(){
	$(".svgWrap .function-icon-eval").parent().addClass("disabled");
}

//获取评分分数
function getVoteValue(){
	var vote_value = 5 - $('.pc_talk_content').find('.evaluation .li-active').length;
	return vote_value;
}


// 隐藏快速提问按钮和界面
function hiddenQuick(){
	try{
		$(".service-help").removeClass("active").slideUp(100);
		$(".icon-hot").parent().removeClass("active");
	}catch(e){}
}

//展示自定义表单
function showVisitorForm(title,ids,formid,button){
	var id_arr=ids.split(',');
	var visitor_form_html='<div id="'+formid+'" class="phone_visitor_form"><p class="visitor_form_title">'+title+'</p>';
	for(var i=0;i<id_arr.length;i++){
		var form_item=visitor_form[id_arr[i]];
		if(form_item.field_type=='1'){//输入框
			if(form_item.field_name=='name'){
				visitor_form_html+='<div data-id="'+id_arr[i]+'" class="visitor_form_ques nomal"><input class="visitor_form_input1" data-type="name" type="text" placeholder="'+form_item.name+'"><p class="tip_error">'+langs[83]+form_item.name+'</p></div>';//请输入
			}else if(form_item.field_name=='mobile'){
				visitor_form_html+='<div data-id="'+id_arr[i]+'" class="visitor_form_ques nomal"><input class="visitor_form_input1" data-type="mobile" type="text" placeholder="'+form_item.name+'"><p class="tip_error">'+langs[0]+form_item.name+'</p></div>';//请输入有效的
			}else if(form_item.field_name=='weixin'){
				visitor_form_html+='<div data-id="'+id_arr[i]+'" class="visitor_form_ques nomal"><input class="visitor_form_input1" data-type="wechat" type="text" placeholder="'+form_item.name+'"><p class="tip_error">'+langs[0]+form_item.name+'</p></div>';
			}else if(form_item.field_name=='qq'){
				visitor_form_html+='<div data-id="'+id_arr[i]+'" class="visitor_form_ques nomal"><input class="visitor_form_input1" data-type="qq" type="text" placeholder="'+form_item.name+'"><p class="tip_error">'+langs[0]+form_item.name+'</p></div>';
			}else if(form_item.field_name=='email'){
				visitor_form_html+='<div data-id="'+id_arr[i]+'" class="visitor_form_ques nomal"><input class="visitor_form_input1" data-type="email" type="text" placeholder="'+form_item.name+'"><p class="tip_error">'+langs[0]+form_item.name+'</p></div>';
			}else{
				visitor_form_html+='<div data-id="'+id_arr[i]+'" class="visitor_form_ques"><input class="visitor_form_input1" type="text" placeholder="'+form_item.name+'"><p class="tip_error">'+langs[83]+form_item.name+'</p></div>';
			}
		}else{//单选
			var single_item=form_item.option_config;
			var option='<option value="'+form_item.name+'" style="display:none">'+form_item.name+'</option>';
			for(var j=0;j<single_item.length;j++){
				option+='<option value="'+single_item[j]+'">'+single_item[j]+'</option>';
			}
			visitor_form_html+='<div data-id="'+id_arr[i]+'" class="visitor_form_ques single_choose" single_item="'+single_item+'"><select class="visitor_form_select" name="" id="">'+option+'</select><p class="tip_error">'+langs[84]+form_item.name+'</p></div>';//请选择
		}
	}
	if (typeof(button) == 'undefined' || button == '') button = langs[81];//提交表单
	visitor_form_html+='<p class="visitor_form_submit" onclick="submitVisitorForm(this)">'+button+'</p></div>';
	$('.pc_talk_content').append(visitor_form_html);
	basic.scrollPage();
}

//移除访客表单
function removeVisitorForm(){
	$('.phone_visitor_form').remove();
}

//改变访客表单显示状态
function changeFormStatus(formid,status){
	if ($("#"+formid).length>0) {
		if (status) {
			$("#"+formid).remove();
			display_sys_msg(langs[82]);//提交成功
		}else{
			$('#'+formid).find('.visitor_form_submit').text(langs[81]).removeClass('submiting');//提交表单
			basic.toastOut(langs[31]);//提交失败，请检查网络连接
		}
	}
}


//访客表单验证正则
function visitor_form_check(param,val) {  
	var bool=false;
	if(param=='name'){
		if(val==''){
			bool=true;
		}
	}else if(param=='mobile'){
		if(!/^1[3-9]\d{9}$/.test(val)){
			bool=true;
		}
	}else if(param=='wechat'){
		if(!/^[-_a-zA-Z0-9]{6,20}$/.test(val)){
			bool=true;
		}
	}else if(param=='qq'){
		if(!/^\d{4,11}$/.test(val)){
			bool=true;
		}
	}else if(param=='email'){
		if(!/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/.test(val)){
			bool=true;
		}
	}
	return bool;
}

//遍历添加二维码
function addQrcode(){
	var $kf_msg = $(".pc-service-right>p");
	var qrcode_str = '<span class="qr_code_53kf"><span class="qr_box_53kf"><span class="qr_img_53kf"><img src="'+qrcode_url+'" alt=""></span><em>'+langs[80]+'</em></span></span>';
	for(var i = 0;i<$kf_msg.length;i++){
		if($kf_msg.eq(i).find(".qr_code_53kf").length<1){
			$kf_msg.eq(i).append(qrcode_str);
		}
	}
	var toppx = 185;
	if (company_tpl == 'minichat') toppx = 119;
	$(".pc-service-right").on("mouseover",".qr_code_53kf",function(){
		$(this).find(".qr_box_53kf").css("display","block");
		var offsetTop = $(this).offset().top;
		var $insertEm = $(this).find(".qr_box_53kf em"),$insertImg = $(this).find(".qr_img_53kf");
		if(offsetTop<toppx){
			$(this).find(".qr_box_53kf").css("bottom","-126px");
			$insertImg.insertAfter($insertEm);
			$insertEm.css("margin-top","5px");
		}else{
			$(this).find(".qr_box_53kf").css("bottom","21px");
			$insertEm.insertAfter($insertImg);
			$insertImg.css("margin-top",0);
			$insertEm.css("margin-top",0);
		}
	})
	$(".pc-service-right").on("mouseout",".qr_code_53kf",function(){
		$(this).find(".qr_box_53kf").css("display","none");
	})
}

// 检查留言和注册时输入项
function check_input(type,field,isMust){
	var obj = '';
	if($.type(field)=='string'){
		if (type == 'reg') {
			obj='reg_'+field;
		}else if (type == 'ly') {
			obj='ly_'+field;
		}
	}else {
		obj=$(this).attr('id');
	};
	switch(obj){
		case 'reg_mobile':
			if (!$.trim($('#'+obj).val()).IsTelephone() && $('#'+obj).val() != '') {
				$('#'+obj).addClass("message-error").prev().find("a").addClass("error-alert");
				return false; 
			}
			break;
		case 'ly_mobile':
			if (!$.trim($('#'+obj).val()).IsTelephone() && $('#'+obj).val() != '') {
				$('#'+obj).addClass("message-error").prev().find("a").addClass("error-alert");
				return false; 
			}
			break;
		case 'reg_email':
			if (!$.trim($('#'+obj).val()).IsEmail() && $('#'+obj).val() != '') {
				$('#'+obj).addClass("message-error").prev().find("a").addClass("error-alert");
				return false; 
			}
			break;
		case 'ly_email':
			if (!$.trim($('#'+obj).val()).IsEmail() && $('#'+obj).val() != '') {
				$('#'+obj).addClass("message-error").prev().find("a").addClass("error-alert");
				return false; 
			}
			break;
		case 'reg_qq':
			if( isNaN($('#'+obj).val()) ) { 
				$('#'+obj).addClass("message-error").prev().find("a").addClass("error-alert");
				return false; 
			}; 
			break;
		case 'ly_qq':
			if( isNaN($('#'+obj).val()) ) { 
				$('#'+obj).addClass("message-error").prev().find("a").addClass("error-alert");
				return false; 
			}; 
			break;
	};
	if (isMust == undefined || isMust == 1) {
		if(!$('#'+obj).val()){
			$('#'+obj).addClass("message-error").prev().find("a").addClass("error-alert");
			return false;
		};
	}
	return true;
}

//输入框内容发生改变时
function inputBoxChange(){
	if(lnkover == 4){
		getRobotTips();
	}
	if (guidance_type == '2') {
		zn_order();
	}
}

//
function window_unload(){
	try{document.cookie = "hz6d_open_talk_"+company_id+"=0";}catch(e){}
}

// 播放音效
function playSound(){
	if (fk_music != '') {
		try{
			if(navigator.userAgent.indexOf("MSIE 8.0")>0){
				$("#bgsoundSound").attr("src",http_pro+host+"/sound/"+fk_music+".mp3");
			}else{
				var myAuto = document.getElementById('audioSound');
				$("#audioSound").attr("src",http_pro+host+"/sound/"+fk_music+".mp3");
				myAuto.play();
			}  
		}catch(e){}
	}
}

function isLoadVoice(msg){
	var reg = /\[voice\].+\[\/voice\]/;
	if(reg.test(msg) && browserType != 'IE'){
		if (!is_load_audioJs) {
			is_load_audioJs = true;
			try{
				var audio_script = document.createElement("script");
				audio_script.src = 'js/new2017/BenzAMRRecorder.min.js';
				document.head.appendChild(audio_script);
			}catch(e){
				return true;
			}
		}
		if(typeof(BenzAMRRecorder) != 'function') return false;
	}
	return true;
}

function filterSensitiveWords(msg){
	try{
		var msg1 = msg.replace(/<img[^>]*src=[\'\"\s]*([^\s\'\"]+)[^>]*>/ig,'');
		var msg2 = msg1;
		for (var i = 0; i < sensitiveWords.length; i++) {
			if (msg2.indexOf(sensitiveWords[i])>-1) {
				var wordReg = new RegExp(sensitiveWords[i],'gim');
				var str = '';
				for (var j = 0; j < sensitiveWords[i].length; j++) {
					str += '*';
				}
				msg2 = msg2.replace(wordReg,str);
			}
		}
		if (msg1 != msg2) {
			var reg = new RegExp(msg1,'gim');
			msg = msg.replace(msg1,msg2);
		}
	}catch(e){}
	return msg;
}

function auto_msg_handle(msg) {
	// PC自动识别2020.04.20->
	// 匹配信息
	msg = msg.replace(/<\/p>|<br>|<br>/g,' ');
	msg = msg.replace(/<[^<>]+>/g,'');
	var phone_reg = /[^\d](1[3-9]\d{9})(?!\d)/g,tel_400_reg = /[^\d]400([-|\s]{0,2})[016789]\d{2}([-|\s]{0,2})\d{4}/g;
	var phone_num="";
	var qq_num="";
	var wx_num="";
	// 过滤掉url 和 img中的超链接，不参与匹配
	var delLinkReg = /<A HREF=.*?<\/A>/g;
	var imgLinkReg = /<IMG.*?insert_img_kf">/g;
	var new_msg = msg.replace(delLinkReg,'');
	new_msg = new_msg.replace(imgLinkReg,'');

	var msg_str = ('`'+HtmlDecode(new_msg)).toLowerCase();
	
	// 获取手机号码
	if(phone_reg.test(msg_str)){
		try{
			var phone_str = msg_str.match(phone_reg)[0];
			phone_num = phone_str.substring(1);
		}catch(e){}
	}
	// else if(tel_400_reg.test(msg_str)){
	// 	try{
	// 		var phone_str = msg_str.match(tel_400_reg)[0];
	// 		phone_num = phone_str.substring(1).replace(/[-|\s]/g ,"");
	// 	}catch(e){}
	// }

	// 获取微信号码
	if(msg_str.toLowerCase().indexOf("wechat")>-1 || (language=='cn' && msg_str.toLowerCase().indexOf("wx")>-1) || msg.toLowerCase().indexOf("weixin")>-1 || msg.indexOf("微信")>-1){
		var newmsg_str = msg_str;
		newmsg_str = newmsg_str.replace(/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[\-;:&=\+\$,\w]+@)?[A-Za-z0-9\.\-]+|(?:www\.|[\-;:&=\+\$,\w]+@)[A-Za-z0-9\.\-]+)((?:\/[\+~%\/\.\w\-_]*)?\??(?:[\-\+=&;%@\.\w_]*)#?(?:[\.\!\/\\\w]*))?)/,'');//过滤网址
		newmsg_str = newmsg_str.replace(/\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/,'');//过滤email
		var weixinReg = /([^?!\w])weixin(?![\w$])/g;
		var wechatReg = /([^?!\w])wechat(?![\w$])/g;
		newmsg_str = newmsg_str.replace(weixinReg,'');
		newmsg_str = newmsg_str.replace(wechatReg,'');
		try{
			if((msg_str.indexOf("微信同号")>-1 || msg_str.indexOf("微信同手机")>-1) && phone_num != ""){
				wx_num = phone_num;
			}else{
				var wx_str = newmsg_str.match(/[^\w]([a-zA-Z_][\wa-zA-Z-_]{5,19})(?![\w])/g)[0];
				wx_num = wx_str.substring(1);
			}
		}catch(e){}
		if(wx_num == "" && phone_num != ""){
			wx_num = phone_num;
		}
	}

	// 获取QQ号码
	if(msg_str.toLowerCase().indexOf("qq")>-1){
		try{
			var qq_msg_str=msg_str.replace(phone_reg,'').replace(wx_num,'');
			var qq_arr = qq_msg_str.match(/[^\d]([1-9]\d{4,10})(?!\d)/g);
			for(var x=0;x<qq_arr.length;x++){
				if(qq_arr[x].substring(1) == phone_num){
					qq_arr.splice(x,1);
					x--;
				}
			}
			qq_num = qq_arr[0].substring(1)
		}catch(e){}
	}

	var wx_ewm = admin_wx_code;
	if(wx_ewm!=''){
		var wx_img='<div class="wx_img"><img src="'+wx_ewm+'" /></div>';
	}else{
		var wx_img='<div class="copy_wx">'+wx_num+'</div>';
	}
	// 按钮结构  98:加 QQ 93:扫码+微信 94:复制微信 95:在线拨打 96:输入手机号码 97:点击免费通话
	try{
		var btn_switch_phone=btn_switch.indexOf('phone')+1;
		var btn_switch_qq=btn_switch.indexOf('qq')+1;
		var btn_switch_wechat=btn_switch.indexOf('wechat')+1;
	}catch(e){}

	var msg_qq_btn = qq_num == '' ?  "" : btn_switch_qq > 0 ? '<div class="msg_btn msg_qq_btn" data_qq ='+qq_num+' onclick="msg_qq_act('+qq_num+')">'+'<div class="msg_act">'+langs[98]+'</div>'+'</div>' : "";

	var msg_wx_btn = wx_num == '' ? "" : btn_switch_wechat > 0 ? '<div class="msg_btn msg_wx_btn" data_wx ='+wx_num+' onclick="msg_wx_act(this)"><div class="msg_act">'+(wx_ewm!=''?langs[93]:langs[94])+'</div>'+wx_img+'</div>' : "";

	if(msg_qq_btn==''){
		if(msg_wx_btn==''){
			var right_position='right:-160px';
		}else{var right_position='right:-80px';}
	}else{
		if(msg_wx_btn==''){
			var right_position='right:-80px';
		}else{var right_position='right:-45px';}
	}

	var msg_phone_btn = phone_num == '' ? "" : btn_switch_phone > 0 ?'<div class="msg_btn msg_phone_btn" data_phone ='+phone_num+' href="tel:'+phone_num+'"><div class="msg_act" onclick="msg_phone_act(this,event)">'+langs[95]+'</div><div class="call_phone_box" style="'+right_position+'"><input class="call_phone_input" type="text" placeholder="'+langs[96]+'"><span class="call_phone_btn">'+langs[97]+'</span></div></div>' : "";

	if(msg_phone_btn==''&&msg_qq_btn==''&&msg_wx_btn==''){
		var msg_btns='';
	}else{
		var msg_btns = '<div class="msg_btns">'+msg_qq_btn+msg_wx_btn+msg_phone_btn+'</div>';
	}
	return msg_btns;
}
function msg_wx_act(ele){
	// 复制微信
	var range = document.createRange(); 
	range.selectNode($(ele).find('.copy_wx')[0]); 
	var selection = window.getSelection(); 
	if(selection.rangeCount > 0) selection.removeAllRanges(); 
	selection.addRange(range); 
	document.execCommand('copy'); 
	basic.toastOut("复制成功");
	if (lnkover == 1 && visitorPathSwitch == '1') {
		g_comm.SendGstm(UrlEncode("访客点击了“复制微信”按钮"));
	}
	sendKafkaNew('guest_click_event','clue','wechat');
}
function msg_qq_act(qq_num){
	if (lnkover == 1 && visitorPathSwitch == '1') {
		g_comm.SendGstm(UrlEncode("访客点击了“加 QQ”按钮"));
	}
	window.open('tencent://message/?uin='+qq_num,'_self');
	sendKafkaNew('guest_click_event','clue','qq');
}
function msg_phone_act(ele,event){
	$(ele).siblings('.call_phone_box').toggle();
	event.stopPropagation();
	if (lnkover == 1 && visitorPathSwitch == '1') {
		g_comm.SendGstm(UrlEncode("访客点击了“在线拨打”按钮"));
	}
}

$('.pc_talk_content').on('click','.call_phone_box',function (event) {
	event.stopPropagation();
});
$(".pc_talk_content").on("click",".call_phone_btn",function(){
	netCallBack(this);
});
$(".pc_talk_content").on("focus",".call_phone_input",function(){
	$(this).removeClass('error');
});

/**
 * 2021.01.06
 * 过滤欢迎语并展示为快捷问题
 * 匹配规则：{{}}
 */
function setupFilter(str){
	var newStr = str || '';
	var matchArray = str.match(/\{\{(.+?)\}\}/g);
	if(matchArray && matchArray.length > 0){
		for(var i = 0; i<matchArray.length; i++){
			// 过滤P标签的换行
			var matchfilterStr = matchArray[i].replace(/<\/p\>\<p(.+?)\>/g,"");
			var replaceStr = matchfilterStr.substring(2,matchfilterStr.length-2);
			var htmlStr = '<span class="check_welcomeServlets" title="点击发送">'+replaceStr+'</span>';
			newStr = newStr.replace(matchArray[i],htmlStr);
		}
	}
	return kwFilter(newStr);
}

/**
 * 2021.03.09
 * 过滤欢迎语替换关键词
 * 匹配规则：[[]]
 */
function kwFilter(str){
	var newStr = str || '';
	var matchKw = str.match(/\[\[(.+?)\]\]/g);
	if(matchKw && matchKw.length > 0){
		for(var i = 0; i<matchKw.length; i++){
			// 过滤P标签的换行
			var matchfilterStr = matchKw[i].replace(/<\/p\>\<p(.+?)\>/g,"");
			var replaceStr = matchfilterStr.substring(2,matchfilterStr.length-2);
			if (keyword != '') replaceStr = keyword;
			newStr = newStr.replace(matchKw[i],replaceStr);
		}
	}
	return newStr;
}

/**
 * 2021.01.06
 * 点击欢迎语快捷问题
 */
$('.pc_talk_content').on('click','.check_welcomeServlets',function(){
	var msg = $(this).text();
	sendmsg(msg);
});


var audio_num = 0;
var audio_vars={};
var is_load_audioJs = false;
$("body").on("click",".audiobtn",function(){
	var _this = this;
	if($(this).hasClass('unaudio_play')){
		basic.toastOut("该浏览器不支持语音播放");
		return false;
	}
	var arr = Object.keys(audio_vars);
	var idx = $(_this).attr("id").split("_")[1]-1;
	$(".audio_log").attr("src","style/chat/new2017/image/png/audio1.png");
	$(".audiobtn").not(_this).removeClass('audio_play');
	for(var i = 0;i<arr.length;i++){
		if(arr[i] == $(_this).attr("id")){
			if (!audio_vars[arr[i]].isPlaying()) {
				$(_this).addClass('audio_play');
				audio_vars[arr[idx]].onEnded(function(){
					$(_this).find(".audio_log").attr("src","style/chat/new2017/image/png/audio1.png");
					$(_this).removeClass('audio_play');
				})
				audio_vars[arr[i]].play();
			} else {
				$(_this).find(".audio_log").attr("src","style/chat/new2017/image/png/audio1.png");
				audio_vars[arr[i]].stop();
				$(_this).removeClass('audio_play');
			}
		}else{
			audio_vars[arr[i]].stop();
		}
	}
});

//访客表单inputfocus去样式
$('.pc_talk_content').on('focus','.visitor_form_input1,.visitor_form_select',function(){
	$(this).removeClass('error_import');
	$(this).siblings('.tip_error').hide();
});

//场景引导用
$(".pc_talk_content").on("click",".from_input",function(e){
	e.stopPropagation();
	$(this).removeClass('error_import');
});


$(function(){
	//机器人相关处理
	$('.pc_talk_content').on("click", ".unuser", function(){
		$(this).addClass("active");
		$(this).parent().siblings("div").show();
		basic.scrollPage_robot();
	});
	$('.pc_talk_content').on("click",".answer_helpful",function(){
		var answer_reason_val = $(this).attr('data-value');
		var answer_id = $(this).parent().parent().prev().attr('id');
		$(this).parent().text(langs[69]);//感谢你的反馈
		$(".pc-robot-eval .df").hide();
		customerResponse(answer_id, answer_reason_val);
	})
	$('.pc_talk_content').on("click",".df li",function(){
		var answer_reason_val = $(this).attr('data-value');
		var answer_id = $(this).parent().parent().parent().prev().attr('id');
		customerResponse(answer_id, answer_reason_val);
	})
	$('.pc_talk_content').on("mousedown", ".pc-robot-eval ul li", function() {
		$(this).addClass("selected").siblings().removeClass("selected");
	});

	$('.pc_talk_content').on("mouseup", ".pc-robot-eval ul li", function() {
		$(this).parent().parent().fadeOut(200);
		$(this).parent().parent().siblings("p").text(langs[69]);//感谢你的反馈
	});
	//点击感叹号重发消息
	$(".talk").on("click",".onError", function(){
		var msg = $(this).prev().html();
		var msg = UBBEncode(msg);
		var msg = UrlEncode(msg);
		var fk_msgid = $(this).attr('id');
		qstmsg(msg,fk_msgid);
		$(this).removeClass('onError');
		try{
			m_qstResTimer[fk_msgid] = setTimeout(function(){
				$("#"+fk_msgid).addClass("onError");
			},20000);
		}catch(e){}
	});

	$(".net_callBack_btn").on("click",function(){
		netCallBack();
	});
});

</script>
<script type="text/javascript" for="snapShot_obj" event="OnSend(a,b,c)">ocx_callback(a,b,c);</script>
<script type="text/javascript">
try{
	var fp = new Fingerprint2();
	fp.get(function(result, components) {
		finger_id = result;
		$.get("wnn_debug.php",{"type":"finger", "info":ip+","+guest_id+","+finger_id, "company_id":company_id, "flag":"finger_idpc"});
	});
}catch(e){}
var isGetSendLnk = false
try{
	window.addEventListener("message",function(event){
		$.get("wnn_debug.php",{"cmd":"sendLNK0","info":ip+","+guest_id,"isGetSendLnk":isGetSendLnk});
		if(lnkover == 2){//对话结束后可以继续邀请
			if(event.data.indexOf('sendLNK{#53#}') != -1){
				isGetSendLnk = true;
				var postMsg = event.data.split('{#53#}');
				$.get("wnn_debug.php",{"cmd":"sendLNK3","info":ip+","+guest_id,"isGetSendLnk":isGetSendLnk});
				worker_ids = postMsg[1];
				isSendLNK=false;
				sendLNK();
			}
			return;
		}
		if (typeof(event.data) != 'string' || isGetSendLnk) return;
		if(event.data.indexOf('sendLNK{#53#}') != -1){
			isGetSendLnk = true;
			$.get("wnn_debug.php",{"cmd":"sendLNK1","info":ip+","+guest_id,"isGetSendLnk":isGetSendLnk});
			var postMsg = event.data.split('{#53#}');
			$.get("wnn_debug.php",{"cmd":"sendLNK2","info":ip+","+guest_id,"isGetSendLnk":isGetSendLnk});
			worker_ids = postMsg[1];
			zn_order();
		}
	});
}catch(e){
	window.attachEvent("onmessage",function(event){
		$.get("wnn_debug.php",{"cmd":"sendLNK0","info":ip+","+guest_id,"isGetSendLnk":isGetSendLnk});
		if(lnkover == 2){//对话结束后可以继续邀请
			if(event.data.indexOf('sendLNK{#53#}') != -1){
				isGetSendLnk = true;
				var postMsg = event.data.split('{#53#}');
				$.get("wnn_debug.php",{"cmd":"sendLNK3","info":ip+","+guest_id,"isGetSendLnk":isGetSendLnk});
				worker_ids = postMsg[1];
				isSendLNK=false;
				sendLNK();
			}
			return;
		}
		if (typeof(event.data) != 'string' || isGetSendLnk) return;
		if(event.data.indexOf('sendLNK{#53#}') != -1){
			isGetSendLnk = true;
			$.get("wnn_debug.php",{"cmd":"sendLNK1","info":ip+","+guest_id,"isGetSendLnk":isGetSendLnk});
			var postMsg = event.data.split('{#53#}');
			$.get("wnn_debug.php",{"cmd":"sendLNK2","info":ip+","+guest_id,"isGetSendLnk":isGetSendLnk});
			worker_ids = postMsg[1];
			zn_order();
		}
	});
}

</script>
<link rel="stylesheet" type="text/css" href="./webuploader.css">
<script type="text/javascript" src="./webuploader.min.js"></script>
<script>
    // 上传=============================start==================================================
  


//解决离线对话不弹文件窗口问题
    setTimeout(function(){
        $("input.webuploader-element-invisible").removeClass('webuploader-element-invisible').css("opacity","0");
    },500)
    
    $(function(){


        var FileUpload = function(picker,uploadURL,acceptObj){

            this.picker = picker;
            this.width = "";
            this.height = "";
            this.uploadURL = uploadURL;
        };

        FileUpload.prototype = {
            init: function(){
                var upload = this.create();
                this.bindEvent(upload);
                return upload;
            },
            create: function(){
                var uploader = WebUploader.create({

                    // 选完文件后，是否自动上传。
                    auto: true,
                    swf: 'js/webuploader/Uploader.swf',
                    server: this.uploadURL,
                    pick: {
                        id: '#'+this.picker,
                    },
                    fileVal: 'userupload',
                    duplicate: true,
                });
                return uploader;
            },
            bindEvent: function(uploader){
                _this = this;
                has_opened = true;
                uploader.on('fileQueued', function(file) {
                    var msg_time = getTime2();
                    file.ext = file.ext.toLowerCase();

                    // 如果在排队中 阻止上传
                    if($(".line-up").css("display")=='block'){
                        uploader.cancelFile( file );
                        return false;
                    };
                    //如果存在文件在上传，阻止上传
                    if(this.getStats().progressNum>=1){
                        uploader.cancelFile( file );
                        return false;
                    }

                    var html,
                        data_id = file.id,
                        name = basic.beforeRender(file.name),
                        size = file.size>1024? Math.floor(file.size/1024)>1024? Math.floor(file.size/1024/1024)+"M":Math.floor(file.size/1024)+"KB":Math.floor(file.size)+"B";

                    if(file.size/1024/1024>=100){
                        basic.toastOut("上传文件/图片不能超过100M");//上传文件/图片不能超过100M
                        uploader.cancelFile( file );
                        return false;
                    };
                    if ("0" == '1') {
                        var file_type_arr = ['jpeg','gif','png','jpg'];
                    }else{
                        var file_type_arr = ['jpeg','gif','png','jpg',"fla","pdf","txt","doc","xls","docx","xlsx","tmp","html","wps","ppt","swf","avi","mpeg","asf","wmv","rm","rmvb","mp3","ape","wma","wav","zip","rar","mp4",'step'];
                    }

                    if($.inArray(file.ext,file_type_arr) == -1){
                        basic.toastOut("暂不支持该格式!");//暂不支持该格式!
                        uploader.cancelFile( file );
                        return false;
                    }

                    if(file.ext == 'jpg' || file.ext == 'png' || file.ext == 'gif' || file.ext == 'jpeg'){
                        
                        html = '<div class="pc-customer"><p><label>'+langs[49]+'</label><span>'+msg_time+'</span></p><div class="upload-wrap fk-uploadFile" id = "'+data_id+'">'+
                            '<div class="upload-image fr">'+
                            '<div class="process-wrap">'+
                            '<span class="processSmall"></span>'+
                            '</div>'+
                            '<div class="statusIcon"></div>'+
                            '</div>'+
                            '</div>'+
                            '</div>';

                        $(".pc_talk_content").append(html);
                        var $img = $("#"+file.id).find(".upload-image");
                        uploader.makeThumb( file, function( error, ret ) {
                            _this.height = file._info.height;
                            _this.width = file._info.width;
                            if ( error ) {
                                $img.text('预览错误');//预览错误
                            } else {
                                $img.append("<img src='"+ret+"' />");
                            }
                        });
                    }else {
                        html = '<div class="pc-customer"><p><label>'+langs[49]+'</label><span>'+msg_time+'</span></p><div class="upload-wrap fk-uploadFile" id = "'+data_id+'">'+
                                    '<div class="upload-file fr"">'+
                                        '<p class="file-header">'+
                                            '<span class="fileName" title="'+file.name+'">'+name+'</span>'+
                                            '<span class="fileSize fr">'+size+'</span>'+
                                        '</p>'+
                                        '<div class="process-wrap"><span class="processLong"><span class="processSmall"></span></span><span class="upload-button"></span></div>'+
                                        '<div class="uploadStatus">上传中</div>'+
                                        '<div class="statusIcon"></div>'+
                                    '</div>'+
                                    '</div>'+
                                '</div>';
                        $(".pc_talk_content").append(html);//36  上传中
                    }
                    $("#"+file.id).get(0).scrollIntoView();
                });

                //上传前
                uploader.on("beforeFileQueued", function(file) {
                    file.ext = file.ext.toLowerCase();
                    var file_type_arr = ['jpeg','gif','png','jpg',"fla","pdf","txt","doc","xls","docx","xlsx","tmp","html","wps","ppt","swf","avi","mpeg","asf","wmv","rm","rmvb","mp3","ape","wma","wav","zip","rar","mp4",'step'];


                    //提前判断是否开启视音频
                    $.ajax({
                        type:"post",
                        url:http_pro+kfs3_host+"/index.php?m=Home&c=MediaUpload&a=before_upload&arg="+arg,
                        data:{
                            "company_id":company_id,
                        },
                        async:false,
                        success:function (mes) {
                            mes=JSON.parse(mes);
                            if(mes.status !='200') has_opened=false;
                            else has_opened=true;
                        }
                    });
                    //如果未开启过或是ie8或ie9，直接进入旧文件传输口
                    if(!has_opened) return true;

                    var userAgent = navigator.userAgent,
                        rMsie = /(msie\s|trident.*rv:)([\w.]+)/,
                        rFirefox = /(firefox)\/([\w.]+)/,
                        rOpera = /(opera).+version\/([\w.]+)/,
                        rChrome = /(chrome)\/([\w.]+)/,
                        rSafari = /version\/([\w.]+).*(safari)/;
                    var browser;
                    var version;
                    var ua = userAgent.toLowerCase();
                    function uaMatch(ua){
                        var match = rMsie.exec(ua);
                        if(match != null){
                            return { browser : "IE", version : match[2] || "0" };
                        }
                        var match = rFirefox.exec(ua);
                        if (match != null) {
                            return { browser : match[1] || "", version : match[2] || "0" };
                        }
                        var match = rOpera.exec(ua);
                        if (match != null) {
                            return { browser : match[1] || "", version : match[2] || "0" };
                        }
                        var match = rChrome.exec(ua);
                        if (match != null) {
                            return { browser : match[1] || "", version : match[2] || "0" };
                        }
                        var match = rSafari.exec(ua);
                        if (match != null) {
                            return { browser : match[2] || "", version : match[1] || "0" };
                        }
                        if (match != null) {
                            return { browser : "", version : "0" };
                        }
                    }
                    var browserMatch = uaMatch(userAgent.toLowerCase());
                    if (browserMatch.browser){
                        browser = browserMatch.browser;
                        version = browserMatch.version;
                    }
                    if(browser == 'IE' && parseInt(version) <= 9){
                        has_opened=false;
                        return true;
                    }
                    
                    //如果出现余额不足等问题，重置url，请求原php地址
                    if(file.flag==true){
                        this.options.formData={"company_id":company_id};
                        this.options.fileVal="userupload";
                        this.options.server=_this.uploadURL;
                        file.flag=false;
                        return true;
                    }
                    if(file.ext == 'mp4'||file.ext == 'mp3'||file.ext == 'wav'||file.ext == 'ogg'){
                        this.options.formData={"company_id":company_id};
                        this.options.fileVal="userfile";
                        this.options.server=http_pro+kfs3_host+"/index.php?m=Home&c=MediaUpload&a=upload&arg="+arg;
                    }
                        
                });

                $(".pc_talk_content").on('click', '.upload-button', function() {
                    uploader.cancelFile( $(this).parents(".upload-wrap").attr("id") );
                    $("#"+$(this).parents(".upload-wrap").attr("id")).find(".process-wrap").hide();
                    $("#"+$(this).parents(".upload-wrap").attr("id")).find(".uploadStatus").text("已取消上传").css("color","#8DA2B5");//已取消上传
                })


                // 重新上传
                $(".talk").on("click",".statusIcon",function(){
                    uploader.retry($(this).parents(".upload-wrap").attr("id"));
                    $(this).parents(".upload-wrap").find(".statusIcon").hide();
                    $(this).parents(".upload-wrap").find(".process-wrap").show();
                    $(this).parents(".upload-wrap").find(".uploadStatus").text("上传中").css("color","#8DA2B5");
                });


                // 文件上传过程中创建进度条实时显示。
                uploader.on('uploadProgress', function(file, percentage) {
                    
                    $("#"+file.id).find(".process-wrap .processSmall").css("width",Math.floor(percentage * 100) + "%");

                });
                // 文件上传成功，给item添加成功class, 用样式标记上传成功。
                uploader.on('uploadSuccess', function (file, response) {
                    //若开通了视音频服务且为视频音频文件
                    if(has_opened&&(file.ext == "mp4"||file.ext == 'mp3'||file.ext == 'wav'||file.ext == 'ogg')){
                        if(response.status=='101' || response.status=='102' || response.status=='103' || response.status=='104'){
                            //basic.toastOut("上传失败");
                            //basic.toastOut("空间不足");
                            //basic.toastOut("空间到期");
                            //basic.toastOut("流量不足");
                            videoUploadResponse(file,response,"cfile",file.name);
                            displayAsFile(file.id,file.name,file.size);
                            file.flag=true;
                            this.upload(file);
                            return false;
                        }else if(response.status=='200'){
                            if(file.ext=="mp4"){
                                //上传video-response
                                videoUploadResponse(file,response,"video",file.name);

                                var $video = $("#"+file.id).find(".upload-file");
                                $video.css("width","260px");
                                $video.find('.file-header').remove();
                                $video.prepend("<video class='upload-video' style='background-color:black;width:240px;height:180px;' src='"+response.url+"' controls='controls' >抱歉，您的浏览器不支持视频播放</video>");
                                $(".process-wrap,.uploadStatus").remove();
                                return true;
                            }else if(file.ext == 'mp3'||file.ext == 'wav'||file.ext == 'ogg'){
                                //上传audio-response
                                videoUploadResponse(file,response,"audio",file.name);
                                var $audio = $("#"+file.id).find(".upload-file");
                                $audio.css("width","262px");
                                $audio.find('.file-header').remove();

                                $audio.prepend("<audio class='upload-audio' style='background-color:white;width:250px;height:55px;margin-left: -5px;' src='"+response.url+"' controls='controls' >抱歉，您的浏览器不支持音频播放</audio>");
                                $(".process-wrap,.uploadStatus").remove();
                                return true;
                            }
                        }
                    }



                    //若为其他
                    var btn_type = response.type;
                    $("#"+file.id).find(".process-wrap").hide();
                    if(response.upload == 'success'){
                        if (btn_type == 'img') {
                            var wh = "?w="+_this.width+"&h="+_this.height;
                            imgUploadResponse(file,response,wh);
                        }else if(btn_type == 'file'){
                            fileUploadResponse(file,response);
                        }
                    }else {
                        $("#"+file.id).find(".uploadStatus").text("上传失败").css("color","#FF4C4C");//上传失败
                        $("#"+file.id).find(".statusIcon").show();
                    }
                });

                // 文件上传失败，显示上传出错。
                uploader.on('uploadError', function(file) {
                    $("#"+file.id).find(".process-wrap").hide();
                    $("#"+file.id).find(".uploadStatus").text("上传失败").css("color","#FF4C4C");//上传失败
                    $("#"+file.id).find(".statusIcon").show();
                });

                //完成上传完了，成功或者失败
                uploader.on('uploadComplete', function(file) {
                    //重置url
                    this.options.formData={"company_id":company_id};
                    this.options.fileVal="userupload";
                    this.options.server=_this.uploadURL;
                });

            }
        }
        var file_upload = new FileUpload('file-picker',http_pro+host+'/upload_img_file.php?company_id='+company_id);
        file_upload.init();
    });

        // 上传=============================end==================================================


        // 图片预加载防止图片闪烁 ============================

        (function(){
            //存放图片路径的数组
            var imgSrcArr = [
                "style/chat/new2017/image/png/toasts.png",
                "style/chat/new2017/image/svg/toasts.svg"
            ];

            var imgWrap = [];

            function preloadImg(arr) {
                for(var i =0; i< arr.length ;i++) {
                    imgWrap[i] = new Image();
                    imgWrap[i].src = arr[i];
                }
            }
            preloadImg(imgSrcArr);
        })()

        //视频上传返回
        function videoUploadResponse(file,response,type,filename){
            if(type=='video'||type=='audio'){
                var file_url = response.url+"*"+filename;
            }else{
                var file_url = http_pro+host+"/down_file.php?type=srv&company_id="+company_id+"&file="+response.real_name;
            }
            file_url = UrlEncode(file_url);
            send_FIL(file_url,type,file.size); // 发送文件给客服
            $("#"+file.id).find(".uploadStatus").text(langs[14]).css("color","#1E88E5");//上传成功
        }
        //显示为视频或音频
        function displayAsVideoAudio(msg,fk_msgid,msg_time,identity,talkname) {

            if(fk_msgid == undefined) {
                var fk_msgid_str = '';
            }else{
                var fk_msgid_str = ' id="'+fk_msgid+'" class="info-status"';
            }
            if (talkname == undefined) talkname = obj_name;
            if (talkname == '') talkname = langs[45];//客服
    
            if (msg_time == undefined) msg_time = getTime2();

            var vdtype=(msg.indexOf("mp4")>-1)?"video":"audio";
            var message=msg.match(/[a-zA-z]+:\/\/[^\s]*/);
            var name=msg.split(message)[1].match(/[\w.]*\.[\w.]*/);
            if(identity=="fk"){
                if(msg.indexOf("mp4")>-1){
                    var show_msg = '<div class="pc-customer"><p><label>'+langs[49]+'</label><span>'+msg_time+'</span></p><div class="pc-customer-info" style="background-color:'+color_fkqp+';"><div class="textWrap" style="color:'+color_fkxx+';"><'+vdtype+' class="upload-'+vdtype+'" style="background-color:black;width:240px;height:180px;" controls="controls" src='+message+'></'+vdtype+'></div><i'+fk_msgid_str+'></i></div></div>';
                }else{
                    var show_msg = '<div class="pc-customer"><p><label>'+langs[49]+'</label><span>'+msg_time+'</span></p><div class="pc-customer-info" style="width:262px;"><div class="textWrap" style="color:'+color_fkxx+';width:262px;"><'+vdtype+' class="upload-'+vdtype+'" style="width:250px;height:55px;margin-left:-2px;" controls="controls" src='+message+'></'+vdtype+'></div><i'+fk_msgid_str+'></i></div></div>';
                }
                //若为ie8及以下浏览器,覆盖show_msg为卡片文件格式
                if(!!window.ActiveXObject&&document.documentMode==8){
                     var show_msg = '<div class="upload-wrap kf-uploadFile">'+
                        '<div class="upload-file fr">'+
                            '<p class="file-header">'+
                                '<span class="fileName" style="min-height:18px;">'+name+'</span>'+
                                '<span class="fileSize fr">'+langs[44]+'</span>'+
                            '</p>'+
                            '<div class="uploadStatus color-blue fr"><a href="'+message+'" target="_blank">'+langs[68]+'</a></div>'+
                            '<div class="statusIcon"></div>'+
                        '</div>'+
                    '</div>';
                }
            }else if(identity=="kf"){
                if(msg.indexOf("mp4")>-1){
                    var show_msg = '<div class="pc-service file_cancel"><div class="pc-service-left" style="display: inline-block;"><img src="'+kf_header+'" alt="'+langs[11]+'"></div><div class="pc-service-right" ><p><label>'+talkname+'</label><span>'+msg_time+'</span></p><div class="upload-wrap kf-uploadFile" >'+'<div class="upload-file fl" style="width:260px;">'+'<video class="upload-video"  style="background-color:black;width:240px;height:180px;" src="'+message+'" controls="controls">抱歉，您的浏览器不支持视频播放</video></div>'+                        '</div>'+'</div></div></div>';
                }else{
                    var show_msg = '<div class="pc-service file_cancel"><div class="pc-service-left" style="display: inline-block;"><img src="'+kf_header+'" alt="'+langs[11]+'"></div><div class="pc-service-right" ><p><label>'+talkname+'</label><span>'+msg_time+'</span></p><div class="upload-wrap kf-uploadFile" style="width:262px;">'+'<div class="upload-file fl" style="width:262px;">'+'<audio class="upload-audio" style="background-color:white;width:250px;height:55px;margin-left:-5px;" src="'+message+'" controls="controls">抱歉，您的浏览器不支持音频播放</audio></div>'+'</div>'+'</div></div></div>';
                }
                //若为ie8及以下浏览器,覆盖show_msg为卡片文件格式
                if(!!window.ActiveXObject&&document.documentMode==8){
                     var show_msg = '<div class="pc-service file_cancel"><div class="pc-service-left" style="display: inline-block;"><img src="'+kf_header+'" alt="'+langs[11]+'"></div><div class="pc-service-right" ><div class="upload-wrap kf-uploadFile">'+
                        '<div class="upload-file fl">'+
                            '<p class="file-header">'+
                                '<span class="fileName" style="min-height:18px;">'+name+'</span>'+
                                '<span class="fileSize fr">'+langs[44]+'</span>'+
                            '</p>'+
                            '<div class="uploadStatus color-blue fr"><a href="'+message+'" target="_blank">'+langs[68]+'</a></div>'+
                            '<div class="statusIcon"></div>'+
                        '</div>'+
                    '</div></div></div>';
                }
            }
            $(".pc_talk_content").append(show_msg);
            basic.scrollPage();
            setQstResTimer(fk_msgid);
        }
        //显示为文件
        function displayAsFile(data_id,file_name,size) {
            var msg_time = getTime2();
            var name=basic.beforeRender(file_name);
            var html = '<div class="pc-customer"><p><label>'+langs[49]+'</label><span>'+msg_time+'</span></p><div class="upload-wrap fk-uploadFile" id = "'+data_id+'">'+
                        '<div class="upload-file fr">'+
                            '<p class="file-header">'+
                                '<span class="fileName" title="'+file_name+'">'+name+'</span>'+
                                '<span class="fileSize fr">'+size+'</span>'+
                            '</p>'+
                            '<div class="uploadStatus color-blue" style="color: rgb(30, 136, 229);">'+langs[14]+'</div>'+
                            '<div class="statusIcon"></div>'+
                        '</div>'+
                        '</div>'+
                    '</div>';
            $("#"+data_id).html(html);
        }
        //左下角by 53
        var timer;
        $(".sm_triangle").mouseenter(function(){
            clearTimeout(timer);
            $(".triangle_to53").show();
        })
        $(".sm_triangle").mouseleave(function(){
            timer = setTimeout(function(){
                $(".triangle_to53").hide();
            },500)
        })
        $(".triangle_to53").mouseenter(function(){
            clearTimeout(timer);
        })
        $(".triangle_to53").mouseleave(function(){
            $(".triangle_to53").hide();
        })
        $(".hover_53").mouseenter(function(){
            $(".hover_53").css("color","#79BAF3");
        })
        $(".hover_53").mouseleave(function(){
            $(".hover_53").css("color","#fff");
        })
        
        // 2019.11.11新增  修复火狐浏览器展开窗口滚至顶部问题
        try{
          window.addEventListener('message',function(event){
            if(event.data == 'openMini'){
              basic.scrollPage();
            }
          });
        }catch(e){}


    
    $('body').on("mouseleave",function(){
        // 浮框因为ifrmae的原因，监听到离开内嵌文档后，重置当前互动菜单的状态
        menu.render(menu_sgin_obj.menu_type,menu_sgin_obj.menu_id,menu_sgin_obj.menu_idx)
    })
    

</script>


</body></html>